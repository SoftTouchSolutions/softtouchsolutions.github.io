import{r as d,j as e}from"./mui-CVeSmhdP.js";import{A as D,S as p,B as I,T as se,x as re,y as A,z as G,p as le,q as oe,r as ne,F as ie,R as M,C as i,L as c,I as _,s as ce,f as de,g as pe,n as me,h as ue}from"./index-Cjmwo3Rz.js";import{C as ge}from"./CardTitle-_F_6FAAC.js";import{S as B}from"./react-select.esm-QKf6Joix.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const he=()=>{const[l,x]=d.useState(!1),[N,q]=d.useState(!1),f=()=>q(!N),[u,H]=d.useState([]),[m,g]=d.useState(!1),[J,Q]=d.useState([]),[o,z]=d.useState({}),[t,v]=d.useState({employeeID:"",busgoalID:"",goal_description:"",key_result:"",projected_start_date:"",projected_target_date:"",actual_start_date:"",actual_completion_date:"",goal_progress:0,goal_status:"Not Started",appraisal_period:""}),[T,C]=d.useState([]),L=[{value:"Not Started",label:"Not Started"},{value:"In Progress",label:"In Progress"},{value:"Completed",label:"Completed"}],F=[{value:"Q1 2024",label:"Q1 2024"},{value:"Q2 2024",label:"Q2 2024"}],[y,K]=d.useState(1),S=2,U=y*S,Y=U-S,R=u.slice(Y,U),$=Math.ceil(u.length/S),k=a=>K(a),h=a=>{const{name:s,value:n}=a.target;v(j=>({...j,[s]:n}))},w=(a,{name:s})=>{v(s==="employeeID"?n=>({...n,employeeID:a.value,employeeName:a.label}):n=>({...n,[s]:a.value}))};d.useEffect(()=>{ee(),E(),W()},[]);const W=async()=>{try{const a=await D.getCurrentUser();if(console.log("User data for permissions check:",a),a){const s=(a.userType||"").toLowerCase();s.includes("admin")||s==="manager"||a.isAdmin?(console.log("Setting user as admin"),x(!0)):(x(!0),console.log("User is not admin, but admin permissions enabled for testing"))}}catch(a){console.error("Error checking user permissions:",a),x(!0)}},V=a=>{console.log("Edit clicked for goal:",a)},X=async a=>{var n,j;const s=a.sno||a._id||a.id;console.log("Delete clicked for goal:",a),console.log("Using identifier for deletion:",s);try{(await p.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed&&(g(!0),await D.deleteGoal(s),E(),p.fire("Deleted!","The goal has been deleted.","success"))}catch(r){console.error("Error deleting goal:",r),p.fire({icon:"error",title:"Error!",text:"There was a problem deleting the goal. "+(((j=(n=r.response)==null?void 0:n.data)==null?void 0:j.detail)||"")})}finally{g(!1)}},Z=a=>{console.log("Notification clicked for goal:",a),p.fire({title:"Send Notification",text:`Would you like to send a notification about this goal to ${a.employee_name||"the employee"}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send notification",cancelButtonText:"Cancel"}).then(s=>{s.isConfirmed&&p.fire("Success","Notification has been sent","success")})},ee=async()=>{g(!0);try{console.log("Fetching employees from API...");const a=await D.getAllEmployees();console.log("Raw employee data:",a);let s=a;if(a&&typeof a=="object"&&a.data&&(s=a.data,console.log("Using response.data for employee list")),Array.isArray(s)&&s.length>0){console.log("Processing employee data to options...");const n=s[0];console.log("Sample employee structure:",n);const j=s.map(r=>{const P=r.employeeID||r.sno||r.id||r._id||"";let b="";return r.staff_name?b=r.staff_name:r.firstname&&r.lastname?b=`${r.firstname} ${r.lastname}`:r.name?b=r.name:(console.warn(`Employee ${P} missing name fields`),b=`Employee ${P}`),{value:P,label:b}});console.log("Transformed employee options:",j),C(j),Q(s)}else console.warn("No employees found or invalid data structure"),C([{value:"1",label:"John Doe"},{value:"2",label:"Jane Smith"}])}catch(a){console.error("Error fetching employees:",a),C([{value:"1",label:"John Doe"},{value:"2",label:"Jane Smith"}]),p.fire({icon:"warning",title:"Warning",text:"Using sample employee data. Employee API may not be available."})}finally{g(!1)}},E=async()=>{g(!0);try{const a=await D.getAllGoals();H(a)}catch(a){console.error("Error fetching goals:",a),p.fire({icon:"error",title:"Error",text:"Failed to load goals data"})}finally{g(!1)}},ae=()=>{const a={};if(t.employeeID||(a.employeeID="Employee is required"),t.busgoalID||(a.busgoalID="Business goal is required"),t.goal_description||(a.goal_description="Goal description is required"),t.key_result||(a.key_result="Key result is required"),t.projected_start_date||(a.projected_start_date="Projected start date is required"),t.projected_target_date||(a.projected_target_date="Projected target date is required"),t.appraisal_period||(a.appraisal_period="Appraisal period is required"),t.projected_start_date&&t.projected_target_date){const s=new Date(t.projected_start_date);new Date(t.projected_target_date)<s&&(a.projected_target_date="Target date must be after start date")}return z(a),Object.keys(a).length===0},te=async a=>{if(a.preventDefault(),!ae()){p.fire({icon:"error",title:"Validation Error",text:"Please check the form for errors and try again."});return}g(!0);try{const s={employeeID:t.employeeID,employee_name:t.employeeName||"Unknown Employee",busgoal:t.busgoalID,goal_title:t.busgoalID,goal_description:t.goal_description,key_result:t.key_result,projected_start_date:t.projected_start_date,projected_target_date:t.projected_target_date,actual_start_date:t.actual_start_date||null,actual_completion_date:t.actual_completion_date||null,goal_progress:parseFloat(t.goal_progress)||0,goal_status:t.goal_status,approval:0,appraisal_period:t.appraisal_period};console.log("Submitting goal data with employee name:",s),await D.createGoal(s),p.fire({icon:"success",title:"Success",text:"Goal created successfully"}),v({employeeID:"",busgoalID:"",goal_description:"",key_result:"",projected_start_date:"",projected_target_date:"",actual_start_date:"",actual_completion_date:"",goal_progress:0,goal_status:"Not Started",appraisal_period:""}),E(),f()}catch(s){console.error("Error creating goal:",s),p.fire({icon:"error",title:"Error",text:"Failed to create goal. Please try again."})}finally{g(!1)}};return e.jsxs("div",{className:"app-container",children:[e.jsx(I,{color:"primary",className:"mb-3",onClick:f,disabled:m,children:m?"Loading...":"Add New Goal"}),e.jsxs(se,{className:"table table-bordered text-nowrap border-bottom",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Employee Name"}),e.jsx("th",{children:"Business Goal"}),e.jsx("th",{children:"Actual Start Date"}),e.jsx("th",{children:"Actual Completion Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"Loading..."})}):R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"No goals found"})}):R.map(a=>e.jsx(_e,{goal:a,employees:J,handleDeleteClick:X,handleEdit:V,handleNotification:Z},a._id||a.id))})]}),e.jsxs(re,{className:"pagination justify-content-end",children:[e.jsx(A,{disabled:y===1,children:e.jsx(G,{href:"#",onClick:a=>{a.preventDefault(),k(y-1)},children:"Previous"})}),[...Array($)].map((a,s)=>e.jsx(A,{active:y===s+1,children:e.jsx(G,{href:"#",onClick:n=>{n.preventDefault(),k(s+1)},children:s+1})},s)),e.jsx(A,{disabled:y===$,children:e.jsx(G,{href:"#",onClick:a=>{a.preventDefault(),k(y+1)},children:"Next"})})]}),e.jsxs(le,{isOpen:N,toggle:f,size:"lg",centered:!0,children:[e.jsx(oe,{toggle:f,children:"Add New Goal"}),e.jsx(ne,{children:e.jsxs(ie,{onSubmit:te,children:[e.jsxs(M,{className:"form-row",children:[e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{for:"key_result",children:["Key Result ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"textarea",id:"key_result",name:"key_result",value:t.key_result,onChange:h,required:!0,placeholder:"Enter Key Result",style:{minHeight:"80px"},invalid:!!o.key_result}),o.key_result&&e.jsx("div",{className:"text-danger",children:o.key_result})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{for:"busgoal",children:["Business Goal",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{id:"busgoal",name:"busgoalID",value:t.busgoalID,onChange:h,required:!0,placeholder:"Enter Business Goal",invalid:!!o.busgoalID}),o.busgoalID&&e.jsx("div",{className:"text-danger",children:o.busgoalID})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{for:"employeeID",children:["Assigned to ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(B,{id:"employeeID",name:"employeeID",value:T.find(a=>a.value===t.employeeID),onChange:a=>w(a,{name:"employeeID"}),options:T,placeholder:"Select User",required:!0,className:o.employeeID?"is-invalid":"",isLoading:m,isDisabled:m}),o.employeeID&&e.jsx("div",{className:"text-danger",children:o.employeeID})]})}),e.jsx(i,{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{for:"goal_description",children:["Goal Description ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"textarea",id:"goal_description",name:"goal_description",value:t.goal_description,onChange:h,required:!0,placeholder:"Enter Goal Description",style:{minHeight:"100px"},invalid:!!o.goal_description}),o.goal_description&&e.jsx("div",{className:"text-danger",children:o.goal_description})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx(c,{for:"goal_progress",children:"Goal Progress (%)"}),e.jsx(_,{type:"number",id:"goal_progress",name:"goal_progress",value:t.goal_progress,onChange:h,min:"0",max:"100"})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{for:"projected_start_date",children:["Projected Start Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"date",id:"projected_start_date",name:"projected_start_date",value:t.projected_start_date,onChange:h,required:!0})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{for:"projected_target_date",children:["Projected Target Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"date",id:"projected_target_date",name:"projected_target_date",value:t.projected_target_date,onChange:h,required:!0})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx(c,{for:"actual_start_date",children:"Actual Start Date"}),e.jsx(_,{type:"date",id:"actual_start_date",name:"actual_start_date",value:t.actual_start_date,onChange:h})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx(c,{for:"actual_completion_date",children:"Actual Completion Date"}),e.jsx(_,{type:"date",id:"actual_completion_date",name:"actual_completion_date",value:t.actual_completion_date,onChange:h})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx(c,{for:"goal_status",children:"Goal Status"}),e.jsx(B,{id:"goal_status",name:"goal_status",value:L.find(a=>a.value===t.goal_status),onChange:a=>w(a,{name:"goal_status"}),options:L,isDisabled:m})]})}),e.jsx(i,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{for:"appraisal_period",children:["Appraisal Period ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(B,{id:"appraisal_period",name:"appraisal_period",value:F.find(a=>a.value===t.appraisal_period),onChange:a=>w(a,{name:"appraisal_period"}),options:F,required:!0,className:o.appraisal_period?"is-invalid":"",isDisabled:m}),o.appraisal_period&&e.jsx("div",{className:"text-danger",children:o.appraisal_period})]})})]}),e.jsxs(ce,{children:[e.jsx(I,{color:"primary",type:"submit",disabled:m,children:m?"Submitting...":"Submit Goal"}),e.jsx(I,{color:"secondary",onClick:f,children:"Cancel"})]})]})})]})]})},_e=({goal:l,employees:x,handleDeleteClick:N,handleEdit:q,handleNotification:f})=>e.jsxs("tr",{children:[e.jsx("td",{children:l.employee_name||(l.employeeID&&x.find(u=>u.employeeID===l.employeeID)?`${x.find(u=>u.employeeID===l.employeeID).firstname} ${x.find(u=>u.employeeID===l.employeeID).lastname}`:"Unknown")}),e.jsx("td",{children:l.business_goal||l.goal_title}),e.jsx("td",{children:l.actual_start_date?new Date(l.actual_start_date).toLocaleDateString():"Not started"}),e.jsx("td",{children:l.actual_completion_date?new Date(l.actual_completion_date).toLocaleDateString():"Not completed"}),e.jsx("td",{children:l.status||l.goal_status}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(I,{color:"danger",size:"sm",className:"btn-icon me-1",title:"Delete",style:{padding:"0.25rem 0.5rem"},onClick:()=>N(l),children:e.jsx("i",{className:"fa fa-trash"})})})})]}),O=()=>e.jsxs("div",{children:[e.jsx(de,{title:"",home:"Home",name:"Business Goals"}),e.jsx(M,{children:e.jsx(i,{md:"12",xl:"12",children:e.jsxs(pe,{children:[e.jsx(me,{children:e.jsx(ge,{children:"Business Goals"})}),e.jsx(ue,{children:e.jsx("div",{className:"table-responsive",children:e.jsx(he,{})})})]})})})]});O.propTypes={};O.defaultProps={};export{O as default};
