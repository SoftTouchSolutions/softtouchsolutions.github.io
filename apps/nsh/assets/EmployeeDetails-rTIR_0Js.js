import{r as i,a as k,j as e}from"./mui-CVeSmhdP.js";import{a as T,B as o,A as b,aa as X,I as Z,S as g,f as ee,R as te,C as se,g as ae,n as re,h as ne}from"./index-BH8F5Bwl.js";import{C as oe}from"./CardTitle-DfjUI6oT.js";import{r as m}from"./index-CpZMvykp.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const n=({children:a})=>e.jsx("div",{style:{textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"flex",justifyContent:"center",alignItems:"center"},children:a}),le=({message:a})=>e.jsx("div",{className:"alert alert-danger",role:"alert",children:a}),ie=()=>e.jsxs("div",{className:"text-center py-5",children:[e.jsx(X,{color:"primary"}),e.jsx("p",{className:"mt-3",children:"Loading employee data..."})]}),P=[{EmployeeName:"Tiger Nixon",Phonenumber:"123-456-7890",Department:"Engineering",Manager:"John Doe",jobrole:"System Architect",contracttype:"Full-time",employmentdate:"2019-02-15",Training:"Leadership Development",skills:"JavaScript, React"},{EmployeeName:"Jane Smith",Phonenumber:"987-654-3210",Department:"Sales",Manager:"Alice Johnson",jobrole:"Sales Manager",contracttype:"Part-time",employmentdate:"2021-07-22",Training:"Sales Strategy",skills:"Negotiation, Communication"}],ce=()=>{const[a,l]=i.useState([]),[c,d]=i.useState(!0),[h,y]=i.useState(null),[N,u]=i.useState(!1),A=T(),p=async()=>{try{const t=await b.getCurrentUser();if(console.log("User data for permissions check:",t),t){const r=(t.userType||"").toLowerCase();r.includes("admin")||r==="manager"||t.isAdmin?(console.log("Setting user as admin"),u(!0)):(console.log("User is not admin, but admin permissions enabled for testing"),u(!0))}}catch(t){console.error("Error checking user permissions:",t),u(!0)}},f=async()=>{try{d(!0),y(null),console.log("Fetching employees...");const t=await b.getAllEmployees();console.log("API response received:",t);let r=[];t?t.data&&Array.isArray(t.data)?(console.log("Using response.data array"),r=t.data):Array.isArray(t)?(console.log("Using response array directly"),r=t):(console.warn("Response is not in expected format:",t),r=[]):(console.warn("Empty response received"),r=[]),console.log("Processing employee data, count:",r.length);const x=(r||[]).filter(s=>s!=null).map(s=>({id:(s==null?void 0:s.id)||(s==null?void 0:s._id)||"",sno:(s==null?void 0:s.sno)||"",EmployeeName:(s==null?void 0:s.staff_name)||`${(s==null?void 0:s.firstname)||""} ${(s==null?void 0:s.lastname)||""}`,Phonenumber:(s==null?void 0:s.phonenumber)||(s==null?void 0:s.phone)||"",Department:(s==null?void 0:s.deptcode)||(s==null?void 0:s.department)||"",Manager:(s==null?void 0:s.managerID)||"",jobrole:(s==null?void 0:s.job_role)||"",contracttype:(s==null?void 0:s.contract_type)||"",employmentdate:s!=null&&s.employment_date?new Date(s==null?void 0:s.employment_date).toLocaleDateString():"",Training:(s==null?void 0:s.training)||"",skills:(s==null?void 0:s.skills)||""}));l(x)}catch(t){console.error("Error fetching employees:",t),y("Failed to load employee data. Please try again later."),l(P)}finally{d(!1)}};i.useEffect(()=>{p(),f()},[]);const C=t=>{console.log("Edit clicked for:",t),A(`/employee/edit/${t.id||t._id||t.sno}`)},E=async t=>{var x,s;const r=t.sno||t._id||t.id;console.log("Delete clicked for employee:",t),console.log("Using identifier for deletion:",r);try{(await g.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed&&(d(!0),await b.deleteEmployee(r),f(),g.fire("Deleted!","The employee has been deleted.","success"))}catch(j){console.error("Error deleting employee:",j),g.fire({icon:"error",title:"Error!",text:"There was a problem deleting the employee. "+(((s=(x=j.response)==null?void 0:x.data)==null?void 0:s.detail)||"")})}finally{d(!1)}},H=t=>{console.log("Notification clicked for:",t),g.fire({title:"Send Notification",text:`Would you like to send a notification to ${t.EmployeeName}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send notification",cancelButtonText:"Cancel"}).then(r=>{r.isConfirmed&&g.fire("Success","Notification has been sent","success")})},B=[{Header:t=>e.jsx(n,{children:"Employee Name"}),accessor:"EmployeeName",className:"text-center w-20 borderrigth"},{Header:t=>e.jsx(n,{children:"Phone Number"}),accessor:"Phonenumber",className:"text-center w-25 borderrigth"},{Header:t=>e.jsx(n,{children:"Department"}),accessor:"Department",className:"text-center w-20 borderrigth"},{Header:t=>e.jsx(n,{children:"Manager"}),accessor:"Manager",className:"text-center w-15 borderrigth"},{Header:t=>e.jsx(n,{children:"Job Role"}),accessor:"jobrole",className:"text-center w-20 borderrigth"},{Header:t=>e.jsx(n,{children:"Contract Type"}),accessor:"contracttype",className:"text-center w-20 borderrigth"},{Header:t=>e.jsx(n,{children:"Employment Date"}),accessor:"employmentdate",className:"text-center w-20 borderrigth"},{Header:t=>e.jsx(n,{children:"Training"}),accessor:"Training",className:"text-center w-15 borderrigth"},{Header:t=>e.jsx(n,{children:"Skills"}),accessor:"skills",className:"text-center w-15 borderrigth"},{Header:t=>e.jsx(n,{children:"Actions"}),accessor:"actions",className:"text-center",Cell:({row:t})=>e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx(o,{color:"primary",size:"sm",className:"btn-icon me-1",title:"Edit",style:{padding:"0.25rem 0.5rem"},onClick:()=>C(t.original),children:e.jsx("i",{className:"fa fa-edit"})}),N&&e.jsx(o,{color:"danger",size:"sm",className:"btn-icon me-1",title:"Delete",style:{padding:"0.25rem 0.5rem"},onClick:()=>E(t.original),children:e.jsx("i",{className:"fa fa-trash"})})]}),disableSortBy:!0}];i.useEffect(()=>{let t=!0;return(async()=>{t&&(await p(),await f())})(),()=>{t=!1}},[]);const I=k.useMemo(()=>a.length>0?a:P,[a]),M=k.useMemo(()=>B,[]),L=m.useTable({columns:M,data:I,initialState:{pageIndex:0}},m.useGlobalFilter,m.useSortBy,m.usePagination),{getTableProps:F,headerGroups:R,getTableBodyProps:U,prepareRow:_,state:z,setGlobalFilter:J,page:O,nextPage:Y,previousPage:$,canNextPage:v,canPreviousPage:w,pageOptions:G,gotoPage:S,pageCount:q,setPageSize:K}=L,{globalFilter:W,pageIndex:Q,pageSize:V}=z;return c?e.jsx(ie,{}):h?e.jsx(le,{message:h}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("select",{className:"mb-4 selectpage border me-1",value:V,onChange:t=>K(Number(t.target.value)),children:[10,25,50].map(t=>e.jsxs("option",{value:t,children:["Show ",t]},t))}),e.jsx(de,{filter:W,setFilter:J})]}),e.jsxs("table",{...F(),className:"table table-bordered table-hover mb-0",children:[e.jsx("thead",{children:R.map(t=>i.createElement("tr",{...t.getHeaderGroupProps(),key:t.id},t.headers.map(r=>i.createElement("th",{...r.getHeaderProps(r.getSortByToggleProps()),className:r.className,key:r.id},r.render("Header"),e.jsx("span",{className:"ms-2",children:r.isSorted?r.isSortedDesc?e.jsx("i",{className:"fa fa-angle-down"}):e.jsx("i",{className:"fa fa-angle-up"}):""})))))}),e.jsx("tbody",{...U(),children:O.map(t=>(_(t),e.jsx(ge,{employee:t.original,handleDeleteClick:E,handleEdit:C,handleNotification:H,isAdmin:N},t.id||t.index)))})]}),e.jsxs("div",{className:"d-block d-sm-flex mt-4",children:[e.jsxs("span",{children:["Page"," ",e.jsxs("strong",{children:[Q+1," of ",G.length]})," "]}),e.jsxs("div",{className:"ms-sm-auto d-flex",children:[e.jsx(o,{color:"",className:"btn-default tablebutton me-2",onClick:()=>S(0),disabled:!w,children:"<<"}),e.jsx(o,{color:"",className:"btn-default tablebutton me-2",onClick:$,disabled:!w,children:"<"}),e.jsx(o,{color:"",className:"btn-default tablebutton me-2",onClick:Y,disabled:!v,children:">"}),e.jsx(o,{color:"",className:"btn-default tablebutton",onClick:()=>S(q-1),disabled:!v,children:">>"})]})]})]})},de=({filter:a,setFilter:l})=>e.jsx("span",{className:"d-flex ms-auto",children:e.jsx(Z,{value:a||"",onChange:c=>l(c.target.value),className:"form-control mb-4",placeholder:"Search..."})}),ge=({employee:a,handleDeleteClick:l,handleEdit:c,handleNotification:d,isAdmin:h})=>e.jsxs("tr",{children:[e.jsx("td",{children:a.EmployeeName||"Unknown"}),e.jsx("td",{children:a.Phonenumber||""}),e.jsx("td",{children:a.Department||""}),e.jsx("td",{children:a.Manager||""}),e.jsx("td",{children:a.jobrole||""}),e.jsx("td",{children:a.contracttype||""}),e.jsx("td",{children:a.employmentdate||""}),e.jsx("td",{children:a.Training||""}),e.jsx("td",{children:a.skills||""}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx(o,{color:"primary",size:"sm",className:"btn-icon me-1",title:"Edit",style:{padding:"0.25rem 0.5rem"},onClick:()=>c(a),children:e.jsx("i",{className:"fa fa-edit"})}),h&&e.jsx(o,{color:"danger",size:"sm",className:"btn-icon me-1",title:"Delete",style:{padding:"0.25rem 0.5rem"},onClick:()=>l(a),children:e.jsx("i",{className:"fa fa-trash"})})]})})]}),D=()=>{const a=T(),l=()=>{console.log("Navigating to create employee page"),a("/employee/create")};return e.jsxs("div",{children:[e.jsx(ee,{title:"",home:"Home",name:"List",fonticonsname:"Emplyees"}),e.jsx(te,{children:e.jsx(se,{className:"col-12",children:e.jsxs(ae,{children:[e.jsxs(re,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",height:"80px"},children:[e.jsx(oe,{children:"List of Employees"}),e.jsx(o,{color:"primary",className:"mb-3",onClick:l,style:{position:"absolute",right:"20px",top:"50%",transform:"translateY(-50%)"},children:"Create New Employee"})]}),e.jsx(ne,{children:e.jsx("div",{className:"table-responsive",children:e.jsx(ce,{},"employee-table")})})]})})})]})};D.propTypes={};D.defaultProps={};export{D as default};
