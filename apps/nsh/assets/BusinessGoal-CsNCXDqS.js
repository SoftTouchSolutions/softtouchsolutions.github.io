import{r as c,j as e}from"./mui-CVeSmhdP.js";import{F as H,B as y,L as j,I as p,T as ne,p as le,q as oe,r as ie,R as K,C as v,s as de,A as C,S as f,f as ce,g as ue,n as me,h as ge,aa as pe}from"./index-Cjmwo3Rz.js";import{C as he}from"./CardTitle-_F_6FAAC.js";import{S as z}from"./react-select.esm-QKf6Joix.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const xe=({goals:l=[],onRefresh:d,predefinedCategories:g=[]})=>{const[_,h]=c.useState(!1),m=()=>h(!_),[w,x]=c.useState(!1),[_e,q]=c.useState(!1),[be,W]=c.useState([]),[A,P]=c.useState([]),[je,U]=c.useState([]),[G,B]=c.useState([]),[D,S]=c.useState(l||[]),[i,F]=c.useState({}),R=[{value:"Growth",label:"Growth"},{value:"Technology",label:"Technology"},{value:"People",label:"People"},{value:"Process",label:"Process"},{value:"Customer",label:"Customer"},{value:"Financial",label:"Financial"}],[n,L]=c.useState({department:"",busgoal_title:"",busgoal_description:"",goal_category:"",key_result:"",start_date:"",end_date:""}),[b,T]=c.useState({id:"",department:"",busgoal_title:"",goal_category:"",key_result:"",start_date:"",end_date:""}),[E,I]=c.useState(null);c.useEffect(()=>{S(l||[])},[l]);const k=t=>{t.preventDefault();const s=t.target.getAttribute("name"),a=t.target.value,r={...n};if(r[s]=a,L(r),i[s]){const o={...i};delete o[s],F(o)}},M=(t,{name:s})=>{const a={...n};if(a[s]=t.value,L(a),i[s]){const r={...i};delete r[s],F(r)}},Y=t=>{t.preventDefault();const s=t.target.getAttribute("name"),a=t.target.value,r={...b};r[s]=a,T(r)},$=()=>{const t={};if(n.department||(t.department="Department is required"),n.busgoal_title||(t.busgoal_title="Goal title is required"),n.goal_category||(t.goal_category="Category is required"),n.key_result||(t.key_result="Key result is required"),n.start_date||(t.start_date="Start date is required"),n.end_date||(t.end_date="End date is required"),n.start_date&&n.end_date){const s=new Date(n.start_date);new Date(n.end_date)<s&&(t.end_date="End date must be after start date")}return F(t),Object.keys(t).length===0},J=async t=>{t.preventDefault();const s=$();if(Object.keys(s).length>0){F(s);return}x(!0);try{const a=G.find(u=>u.value===n.goal_category),r=A.find(u=>u.value===n.department),o={departmentID:r?r.value:n.department,busgoal_title:n.busgoal_title,busgoal_description:n.busgoal_description||"",goal_category:a?a.value:n.goal_category,key_result:n.key_result,start_date:n.start_date,end_date:n.end_date};console.log("Department options:",A),console.log("Category options:",G),console.log("Selected department:",r),console.log("Selected category:",a),console.log("Department ID being sent:",o.departmentID),console.log("Goal category being sent:",o.goal_category),console.log("Full data being sent:",o);let N;try{N=await C.createBusinessGoal(o),console.log("Business goal created:",N);const u=[...D,N];S(u),f.fire({icon:"success",title:"Success",text:"Business goal created successfully!"}),L({department:"",busgoal_title:"",busgoal_description:"",goal_category:"",key_result:"",start_date:"",end_date:""}),typeof toggleAddModal=="function"&&toggleAddModal()}catch(u){if(console.error("Error adding business goal:",u),u.response){console.error("Error response data:",u.response.data),console.error("Error response status:",u.response.status);let O="Failed to create business goal";u.response.data&&u.response.data.detail&&(O=u.response.data.detail),f.fire({icon:"error",title:"Error",text:O})}else f.fire({icon:"error",title:"Error",text:"Failed to create business goal. Please try again."});x(!1);return}L({department:"",busgoal_title:"",busgoal_description:"",goal_category:"",key_result:"",start_date:"",end_date:""}),m(),typeof d=="function"&&d()}catch(a){console.error("Error adding business goal:",a),f.fire({icon:"error",title:"Error",text:"Failed to add business goal. Please try again."})}finally{x(!1)}},Q=async t=>{t.preventDefault(),x(!0);try{const s={department:b.department,busgoal_title:b.busgoal_title,goal_category:b.goal_category,key_result:b.key_result,start_date:b.start_date,end_date:b.end_date};await C.updateBusinessGoal(E,s),console.log("Business goal updated:",E);const a=D.findIndex(r=>r.id===E||r.sno===E);if(a!==-1){const r=[...D];r[a]={...r[a],...s},S(r)}I(null),typeof d=="function"&&d()}catch(s){console.error("Error updating business goal:",s),f.fire({icon:"error",title:"Error",text:"Failed to update business goal. Please try again."})}finally{x(!1)}},X=(t,s)=>{t.preventDefault(),I(s.id);const a={id:s.id,department:s.department,busgoal_title:s.busgoal_title,goal_category:s.goal_category,key_result:s.key_result,start_date:s.start_date,end_date:s.end_date};T(a)},Z=()=>{I(null)},ee=async t=>{if((await f.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed){x(!0);try{const a=t.id||t.sno;await C.deleteBusinessGoal(a),console.log("Business goal deleted:",a);const r=D.filter(o=>t.id?o.id!==t.id:o.sno!==t.sno);S(r),f.fire("Deleted!","The business goal has been deleted.","success"),typeof d=="function"&&d()}catch(a){console.error("Error deleting business goal:",a),f.fire({icon:"error",title:"Error",text:"Failed to delete business goal. Please try again."})}finally{x(!1)}}},te=async()=>{try{const t=await C.getCurrentUser();if(console.log("User data for permissions check:",t),t){const s=(t.userType||"").toLowerCase();s.includes("admin")||s==="manager"||t.isAdmin?(console.log("Setting user as admin"),q(!0)):(console.log("User is not admin, but admin permissions enabled for testing"),q(!0))}}catch(t){console.error("Error checking user permissions:",t),q(!0)}},se=async()=>{x(!0);try{console.log("Fetching departments from API...");const t=await C.getAllDepartments();console.log("Raw department data:",t);let s=t;if(t&&typeof t=="object"&&t.data&&(s=t.data,console.log("Using response.data for department list")),Array.isArray(s)&&s.length>0){console.log("Processing department data to options...");const a=s[0];console.log("Sample department structure:",a);const r=s.map(o=>{const N=o.deptcode||o.id||o._id||"";let u=o.deptname||o.name||"Unknown Department";return{value:N,label:u}});console.log("Transformed department options:",r),P(r),W(s)}else console.warn("No departments found or invalid data structure"),P([{value:"SALES",label:"Sales"},{value:"ENG",label:"Engineering"},{value:"HR",label:"Human Resources"},{value:"FINANCE",label:"Finance"}])}catch(t){console.error("Error fetching departments:",t),P([{value:"SALES",label:"Sales"},{value:"ENG",label:"Engineering"},{value:"HR",label:"Human Resources"},{value:"FINANCE",label:"Finance"}]),f.fire({icon:"warning",title:"Warning",text:"Using sample department data. Department API may not be available."})}finally{x(!1)}},ae=async()=>{x(!0);try{if(g&&g.length>0){console.log("Using predefined categories:",g);const t=g.map(s=>{const a=s.id||s._id||s.value||"",r=s.categoryName||s.name||s.label||"Unknown Category";return{value:a,label:r}});console.log("Using categories from parent component:",t),B(t),U(g)}else{console.log("No predefined categories, fetching from API...");const t=await C.getAllGoalCategories();console.log("Raw category data from API:",t);let s=t;if(t&&typeof t=="object"&&t.data&&(s=t.data,console.log("Using response.data for category list")),Array.isArray(s)&&s.length>0){console.log("Processing category data to options...");const a=s[0];console.log("Sample category structure:",a);const r=s.map(o=>{const N=o.id||o._id||o.code||"";let u=o.categoryName||o.name||o.value||"Unknown Category";return{value:N,label:u}});console.log("Transformed category options:",r),B(r),U(s)}else console.warn("No categories found or invalid data structure"),B(R)}}catch(t){console.error("Error fetching categories:",t),B(R),f.fire({icon:"warning",title:"Warning",text:"Using sample category data. Categories may not be available."})}finally{x(!1)}};c.useEffect(()=>{te(),se(),ae()},[]);const re=t=>{if(!t){S(l||[]);return}const s=D.filter(a=>(a.department_name||a.department||"").toLowerCase().includes(t.toLowerCase())||(a.busgoal_title||"").toLowerCase().includes(t.toLowerCase())||(a.goal_category||"").toLowerCase().includes(t.toLowerCase()));S(s)};return e.jsxs("div",{className:"app-container",children:[e.jsxs(H,{onSubmit:Q,children:[e.jsx(y,{color:"",className:"btn btn-primary mb-3",onClick:m,children:"Add New Business Goal"}),e.jsx(j,{className:"float-end",children:e.jsx(p,{type:"text",placeholder:"Search...",className:"mb-4 form-control-sm form-control",onChange:t=>re(t.target.value)})}),e.jsxs(ne,{className:"table table-bordered text-nowrap border-bottom",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Goal Title"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Key Result"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:D.map(t=>e.jsx(c.Fragment,{children:E===t.id?e.jsx(fe,{editFormData:b,handleEditFormChange:Y,handleCancelClick:Z}):e.jsx(ye,{goal:t,handleEditClick:X,handleDeleteClick:ee})},t.id))})]})]}),e.jsxs(le,{isOpen:_,toggle:m,size:"lg",centered:!0,children:[e.jsxs(oe,{children:["Add New Business Goal",e.jsx(y,{color:"",className:"btn btn-close",onClick:m,children:"x"})]}),e.jsx(ie,{children:e.jsxs(H,{onSubmit:J,children:[e.jsxs(K,{children:[e.jsx(v,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{for:"department",children:["Department ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(z,{id:"department",name:"department",value:A.find(t=>t.value===n.department),onChange:t=>M(t,{name:"department"}),options:A,placeholder:"Select Department",required:!0,className:i.department?"is-invalid":"",isLoading:w,isDisabled:w}),i.department&&e.jsx("div",{className:"text-danger",children:i.department})]})}),e.jsx(v,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{for:"busgoal_title",children:["Goal Title ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(p,{id:"busgoal_title",name:"busgoal_title",value:n.busgoal_title,onChange:k,required:!0,placeholder:"Enter Goal Title",invalid:!!i.busgoal_title}),i.busgoal_title&&e.jsx("div",{className:"text-danger",children:i.busgoal_title})]})}),e.jsx(v,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{for:"busgoal_description",children:"Goal Description"}),e.jsx(p,{id:"busgoal_description",name:"busgoal_description",value:n.busgoal_description,onChange:k,placeholder:"Enter Goal Description"})]})}),e.jsx(v,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{for:"goal_category",children:["Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(z,{id:"goal_category",name:"goal_category",value:G.find(t=>t.value===n.goal_category),onChange:t=>M(t,{name:"goal_category"}),options:G,placeholder:"Select Category",required:!0,className:i.goal_category?"is-invalid":"",isLoading:w,isDisabled:w}),i.goal_category&&e.jsx("div",{className:"text-danger",children:i.goal_category})]})}),e.jsx(v,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{for:"key_result",children:["Key Result ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(p,{type:"textarea",id:"key_result",name:"key_result",value:n.key_result,onChange:k,required:!0,placeholder:"Enter Key Result",style:{minHeight:"80px"},invalid:!!i.key_result}),i.key_result&&e.jsx("div",{className:"text-danger",children:i.key_result})]})}),e.jsx(v,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{for:"start_date",children:["Start Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(p,{type:"date",id:"start_date",name:"start_date",value:n.start_date,onChange:k,required:!0,invalid:!!i.start_date}),i.start_date&&e.jsx("div",{className:"text-danger",children:i.start_date})]})}),e.jsx(v,{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{for:"end_date",children:["End Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(p,{type:"date",id:"end_date",name:"end_date",value:n.end_date,onChange:k,required:!0,invalid:!!i.end_date}),i.end_date&&e.jsx("div",{className:"text-danger",children:i.end_date})]})})]}),e.jsx(y,{color:"primary",className:"me-2",type:"submit",disabled:w,children:w?"Submitting...":"Add Goal"})]})}),e.jsx(de,{children:e.jsx(y,{color:"secondary",onClick:m,children:"Close"})})]})]})},fe=({editFormData:l,handleEditFormChange:d,handleCancelClick:g})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(p,{type:"text",required:!0,name:"department",value:l.department,onChange:d,className:"border"})}),e.jsx("td",{children:e.jsx(p,{type:"text",required:!0,name:"busgoal_title",value:l.busgoal_title,onChange:d,className:"border"})}),e.jsx("td",{children:e.jsx(p,{type:"text",required:!0,name:"goal_category",value:l.goal_category,onChange:d,className:"border"})}),e.jsx("td",{children:e.jsx(p,{type:"text",required:!0,name:"key_result",value:l.key_result,onChange:d,className:"border"})}),e.jsx("td",{children:e.jsx(p,{type:"date",required:!0,name:"start_date",value:l.start_date,onChange:d,className:"border"})}),e.jsx("td",{children:e.jsx(p,{type:"date",required:!0,name:"end_date",value:l.end_date,onChange:d,className:"border"})}),e.jsxs("td",{children:[e.jsx(y,{color:"",className:"btn btn-primary me-1",type:"submit",children:"Save"}),e.jsx(y,{color:"",className:"btn btn-danger me-1",type:"button",onClick:g,children:"Cancel"})]})]}),ye=({goal:l,handleEditClick:d,handleDeleteClick:g})=>{const _=h=>{if(!h)return"N/A";try{return new Date(h).toLocaleDateString()}catch{return h}};return e.jsxs("tr",{children:[e.jsx("td",{children:l.department_name||l.department}),e.jsx("td",{children:l.busgoal_title}),e.jsx("td",{children:l.goal_category}),e.jsx("td",{children:l.key_result}),e.jsx("td",{children:_(l.start_date)}),e.jsx("td",{children:_(l.end_date)}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx(y,{color:"primary",size:"sm",className:"btn-icon me-1",title:"Edit",style:{padding:"0.25rem 0.5rem"},onClick:h=>d(h,l),children:e.jsx("i",{className:"fa fa-edit"})}),e.jsx(y,{color:"danger",size:"sm",className:"btn-icon me-1",title:"Delete",style:{padding:"0.25rem 0.5rem"},onClick:()=>g(l),children:e.jsx("i",{className:"fa fa-trash"})})]})})]})},V=()=>{const[l,d]=c.useState([]),[g,_]=c.useState(!1);c.useEffect(()=>{h()},[]);const h=async()=>{_(!0);try{const m=await C.getAllBusinessGoals();console.log("Fetched business goals:",m),m&&Array.isArray(m)?d(m):(console.warn("No valid business goals data returned"),d([]))}catch(m){console.error("Error fetching business goals:",m),d([]),f.fire({icon:"error",title:"Error",text:"Failed to fetch business goals from the server. Please try again later."})}finally{_(!1)}};return e.jsxs("div",{children:[e.jsx(ce,{title:"Business Goals"}),e.jsx(K,{children:e.jsx(v,{sm:12,children:e.jsxs(ue,{children:[e.jsxs(me,{className:"d-flex justify-content-between align-items-center",children:[e.jsx(he,{children:"Business Goals List"}),e.jsx("div",{children:e.jsxs(y,{color:"primary",size:"sm",onClick:h,disabled:g,className:"me-2",children:[e.jsx("i",{className:"fa fa-refresh me-1"}),g?"Refreshing...":"Refresh"]})})]}),e.jsx(ge,{children:g?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(pe,{color:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading business goals..."})]}):e.jsx(xe,{goals:l,onRefresh:h})})]})})})]})};V.propTypes={};V.defaultProps={};export{V as default};
