import{r as j,j as e}from"./mui-CVeSmhdP.js";import{a as de,A as g,S as _,f as ce,R as Q,C as u,g as me,n as pe,B as S,h as he,I as c,aa as xe,T as ue,x as fe,y as P,z as I,p as je,q as ve,r as _e,F as ye,v as m,L as p,s as ge}from"./index-BH8F5Bwl.js";import{C as we}from"./CardTitle-DfjUI6oT.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const Pe=()=>{const W=de(),[q,V]=j.useState(!1),w=()=>V(!q),[J,v]=j.useState(!1),[G,K]=j.useState(""),[D,B]=j.useState({}),[De,L]=j.useState([]),[k,T]=j.useState([]),[R,b]=j.useState([]),[y,X]=j.useState(1),O=5,[n,h]=j.useState({employeeID:"",staff_name:"",deptcode:"",deptname:"",reviewPeriod:"",feedback_date:"",task_execution:"",power_skills:"",attitude:"",overall_goal_status:"",points_earned:"",total_score:"",finalGrade:"",recommendation:"",approved:"No"}),[d,x]=j.useState({id:"",employeeID:"",staff_name:"",deptcode:"",deptname:"",reviewPeriod:"",feedback_date:"",task_execution:"",power_skills:"",attitude:"",overall_goal_status:"",points_earned:"",total_score:"",finalGrade:"",recommendation:"",approved:"No"}),[r,Y]=j.useState(null),Z=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString()}catch{return t}},ee=t=>{if(!t)return R;const o=t.toLowerCase();return R.filter(a=>a.staff_name&&a.staff_name.toLowerCase().includes(o)||a.reviewPeriod&&a.reviewPeriod.toLowerCase().includes(o)||a.deptname&&a.deptname.toLowerCase().includes(o))},N=j.useMemo(()=>ee(G),[R,G]),M=y*O,z=M-O,H=N.slice(z,M),E=Math.ceil(N.length/O),C=t=>X(t),te=()=>{W("/feed/back")};j.useEffect(()=>{ae(),se(),A()},[]);const ae=async()=>{v(!0);try{const t=await g.getAllDepartments();console.log("Fetched departments:",t),t&&t.length>0?L(t):(L([]),console.log("No departments found in the database"))}catch(t){console.error("Error fetching departments:",t),L([]),_.fire({icon:"error",title:"Error",text:"Failed to fetch departments from the server. Please try again later."})}finally{v(!1)}},se=async()=>{v(!0);try{const t=await g.getAllEmployees();console.log("Fetched employees:",t),t&&t.length>0?T(t):(T([]),console.log("No employees found in the database"))}catch(t){console.error("Error fetching employees:",t),T([]),_.fire({icon:"error",title:"Error",text:"Failed to fetch employees from the server. Please try again later."})}finally{v(!1)}},A=async()=>{v(!0);try{const t=await g.getAllFeedbacks(0,100);if(console.log("Fetched feedbacks:",t),!t||!t.feedbacks){b([]),console.log("No valid feedback data received");return}const o=t.feedbacks.map(a=>{let s={};if(a.employeeID&&(!a.staff_name||!a.deptname)){const l=k.find(F=>F.employeeID===a.employeeID);l?(s={staff_name:l.staff_name||"",deptcode:l.deptcode||"",deptname:l.deptname||""},console.log(`Found employee data for ${a.employeeID}:`,s)):console.log(`No employee found for ID ${a.employeeID}`)}const i={id:a.feedbackID||a._id,sno:a.sno,employeeID:a.employeeID,staff_name:a.staff_name||s.staff_name||"",deptcode:a.deptcode||s.deptcode||"",deptname:a.deptname||s.deptname||"",reviewPeriod:a.reviewPeriod,feedback_date:a.feedback_date,task_execution:a.task_execution?a.task_execution.toString():"",power_skills:a.power_skills?a.power_skills.toString():"",attitude:a.attitude?a.attitude.toString():"",overall_goal_status:a.overall_goal_status?a.overall_goal_status.toString():"",points_earned:a.points_earned?a.points_earned.toString():"0",total_score:a.total_score?a.total_score.toString():"0.0",finalGrade:a.finalGrade||"Unsatisfactory",recommendation:a.recommendation||"",approved:a.approved===1?"Yes":"No"};return console.log(`Transformed feedback for ${a.employeeID}:`,{staff_name:i.staff_name,deptname:i.deptname}),i});o&&o.length>0?b(o):(b([]),console.log("No feedbacks found in the database")),o&&o.length>0&&oe().catch(a=>{console.warn("Could not fetch feedback stats:",a)})}catch(t){console.error("Error fetching feedbacks:",t),b([]),_.fire({icon:"error",title:"Error",text:"Failed to fetch feedbacks from the server. Please try again later."})}finally{v(!1)}},oe=async()=>{try{const t=await g.getFeedbackStats();return console.log("Feedback stats:",t),t}catch(t){return console.error("Error fetching feedback stats:",t),null}},f=(t,o)=>{const{name:a,value:s}=t.target;if(o(i=>({...i,[a]:s})),a==="employeeID"&&s){const i=k.find(l=>l.employeeID===s);i&&o(l=>({...l,staff_name:i.staff_name||"",deptcode:i.deptcode||"",deptname:i.deptname||""}))}},re=()=>{const t={};return n.employeeID||(t.employeeID="Employee is required"),n.reviewPeriod||(t.reviewPeriod="Review period is required"),n.feedback_date||(t.feedback_date="Feedback date is required"),B(t),Object.keys(t).length===0},U=async t=>{var o,a;if(t.preventDefault(),!!re()){v(!0);try{const s={...n};if(s.employeeID&&(!s.staff_name||!s.deptname)){const l=k.find(F=>F.employeeID===s.employeeID);l&&(s.staff_name=l.staff_name||"",s.deptcode=l.deptcode||"",s.deptname=l.deptname||"")}console.log("Submitting feedback with employee data:",{employeeID:s.employeeID,staff_name:s.staff_name,deptcode:s.deptcode,deptname:s.deptname});const i=await g.createFeedback(s);console.log("Created feedback:",i),await A(),h({employeeID:"",staff_name:"",deptcode:"",deptname:"",reviewPeriod:"",feedback_date:"",task_execution:"",power_skills:"",attitude:"",overall_goal_status:"",points_earned:"",total_score:"",finalGrade:"",recommendation:"",approved:"No"}),B({}),w(),_.fire({icon:"success",title:"Success",text:"Feedback added successfully!"})}catch(s){console.error("Error adding feedback:",s),_.fire({icon:"error",title:"Error",text:((a=(o=s.response)==null?void 0:o.data)==null?void 0:a.detail)||"Failed to add feedback. Please try again."})}finally{v(!1)}}},ne=(t,o)=>{t.preventDefault(),Y(o.id);const a={id:o.id,sno:o.sno,employeeID:o.employeeID||"",staff_name:o.staff_name||"",deptcode:o.deptcode||"",deptname:o.deptname||"",reviewPeriod:o.reviewPeriod||"",feedback_date:o.feedback_date||"",task_execution:o.task_execution||"",power_skills:o.power_skills||"",attitude:o.attitude||"",overall_goal_status:o.overall_goal_status||"",points_earned:o.points_earned||"",total_score:o.total_score||"",finalGrade:o.finalGrade||"",recommendation:o.recommendation||"",approved:o.approved||"No"};x(a),w()},$=async t=>{var o,a;t.preventDefault(),v(!0);try{const s={...d};if(s.employeeID&&(!s.staff_name||!s.deptname)){const l=k.find(F=>F.employeeID===s.employeeID);l&&(s.staff_name=l.staff_name||"",s.deptcode=l.deptcode||"",s.deptname=l.deptname||"")}console.log("Updating feedback with employee data:",{employeeID:s.employeeID,staff_name:s.staff_name,deptcode:s.deptcode,deptname:s.deptname});const i=s.sno||r;await g.updateFeedback(i,s),await A(),Y(null),w(),_.fire({icon:"success",title:"Success",text:"Feedback updated successfully!"})}catch(s){console.error("Error updating feedback:",s),_.fire({icon:"error",title:"Error",text:((a=(o=s.response)==null?void 0:o.data)==null?void 0:a.detail)||"Failed to update feedback. Please try again."})}finally{v(!1)}},le=t=>{_.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async o=>{var a,s;if(o.isConfirmed){v(!0);try{await g.deleteFeedback(t.sno||t.id),await A()}catch(i){console.error("Error deleting feedback:",i),_.fire({icon:"error",title:"Error",text:((s=(a=i.response)==null?void 0:a.data)==null?void 0:s.detail)||"Failed to delete feedback. Please try again."})}finally{v(!1)}}})},ie=()=>{Y(null),B({}),w()};return e.jsxs("div",{children:[e.jsx(ce,{title:"",home:"Home",name:"List",fonticonsname:"Feed Backs"}),e.jsx(Q,{children:e.jsx(u,{className:"col-12",children:e.jsxs(me,{children:[e.jsxs(pe,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",height:"80px"},children:[e.jsx(we,{children:"Feed Backs"}),e.jsx(S,{color:"primary",className:"mb-3",onClick:te,style:{position:"absolute",right:"20px",top:"50%",transform:"translateY(-50%)"},children:"Create New FeedBack"})]}),e.jsxs(he,{children:[e.jsx("div",{className:"d-flex mb-3",children:e.jsx(c,{type:"text",placeholder:"Search...",value:G,onChange:t=>K(t.target.value),className:"form-control w-25"})}),J?e.jsx("div",{className:"text-center my-3",children:e.jsx(xe,{color:"primary"})}):e.jsxs("div",{className:"table-responsive",children:[e.jsxs(ue,{bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Staff Name"}),e.jsx("th",{children:"Review Period"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Feedback Date"}),e.jsx("th",{children:"Task Execution"}),e.jsx("th",{children:"Power Skills"}),e.jsx("th",{children:"Attitude"}),e.jsx("th",{children:"Overall Status"}),e.jsx("th",{children:"Points"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Grade"}),e.jsx("th",{children:"Approved"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:H.length>0?H.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.staff_name}),e.jsx("td",{children:t.reviewPeriod}),e.jsx("td",{children:t.deptname}),e.jsx("td",{children:Z(t.feedback_date)}),e.jsx("td",{children:t.task_execution}),e.jsx("td",{children:t.power_skills}),e.jsx("td",{children:t.attitude}),e.jsx("td",{children:t.overall_goal_status}),e.jsx("td",{children:t.points_earned}),e.jsx("td",{children:t.total_score}),e.jsx("td",{children:t.finalGrade}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.approved==="Yes"?"bg-success":"bg-danger"}`,children:t.approved})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(S,{color:"primary",size:"sm",className:"me-2",onClick:o=>ne(o,t),children:e.jsx("i",{className:"fa fa-edit"})}),e.jsx(S,{color:"danger",size:"sm",onClick:()=>le(t),children:e.jsx("i",{className:"fa fa-trash"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"13",className:"text-center",children:"No feedback records found"})})})]}),N.length>0&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{children:["Showing ",z+1," to ",Math.min(M,N.length)," of ",N.length," entries"]}),e.jsxs(fe,{children:[e.jsx(P,{disabled:y===1,children:e.jsx(I,{first:!0,onClick:()=>C(1)})}),e.jsx(P,{disabled:y===1,children:e.jsx(I,{previous:!0,onClick:()=>C(y-1)})}),[...Array(E).keys()].map(t=>e.jsx(P,{active:y===t+1,children:e.jsx(I,{onClick:()=>C(t+1),children:t+1})},t)),e.jsx(P,{disabled:y===E,children:e.jsx(I,{next:!0,onClick:()=>C(y+1)})}),e.jsx(P,{disabled:y===E,children:e.jsx(I,{last:!0,onClick:()=>C(E)})})]})]})]})]})]})})}),e.jsxs(je,{isOpen:q,toggle:w,size:"lg",children:[e.jsx(ve,{toggle:w,children:r?"Edit Feedback":"Add New Feedback"}),e.jsx(_e,{children:e.jsx(ye,{onSubmit:r?$:U,children:e.jsxs(Q,{children:[e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"employeeSelect",children:"Select Employee"}),e.jsxs(c,{type:"select",name:"employeeID",id:"employeeSelect",value:r?d.employeeID:n.employeeID,onChange:t=>f(t,r?x:h),className:"mb-2",disabled:r,children:[e.jsx("option",{value:"",children:"-- Select Employee --"}),k.map(t=>e.jsxs("option",{value:t.employeeID,children:[t.staff_name," - ",t.job_role||"N/A"]},t.employeeID))]}),D.employeeID&&e.jsx("div",{className:"text-danger",children:D.employeeID})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"staff_name",children:"Staff Name"}),e.jsx(c,{type:"text",id:"staff_name",name:"staff_name",placeholder:"Staff Name",value:r?d.staff_name:n.staff_name,onChange:t=>f(t,r?x:h),readOnly:!0,className:"mb-2"})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"deptname",children:"Department"}),e.jsx(c,{type:"text",id:"deptname",name:"deptname",placeholder:"Department",value:r?d.deptname:n.deptname,readOnly:!0,className:"mb-2"})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"reviewPeriod",children:"Review Period"}),e.jsx(c,{type:"text",id:"reviewPeriod",name:"reviewPeriod",placeholder:"e.g. Q1 2024",value:r?d.reviewPeriod:n.reviewPeriod,onChange:t=>f(t,r?x:h),required:!0,className:"mb-2"}),D.reviewPeriod&&e.jsx("div",{className:"text-danger",children:D.reviewPeriod})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"feedback_date",children:"Feedback Date"}),e.jsx(c,{type:"date",id:"feedback_date",name:"feedback_date",value:r?d.feedback_date:n.feedback_date,onChange:t=>f(t,r?x:h),required:!0,className:"mb-2"}),D.feedback_date&&e.jsx("div",{className:"text-danger",children:D.feedback_date})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"task_execution",children:"Task Execution"}),e.jsxs(c,{type:"select",id:"task_execution",name:"task_execution",value:r?d.task_execution:n.task_execution,onChange:t=>f(t,r?x:h),className:"mb-2",children:[e.jsx("option",{value:"",children:"-- Select Rating --"}),e.jsx("option",{value:"Excellent",children:"Excellent"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Average",children:"Average"}),e.jsx("option",{value:"Poor",children:"Poor"})]})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"power_skills",children:"Power Skills"}),e.jsxs(c,{type:"select",id:"power_skills",name:"power_skills",value:r?d.power_skills:n.power_skills,onChange:t=>f(t,r?x:h),className:"mb-2",children:[e.jsx("option",{value:"",children:"-- Select Rating --"}),e.jsx("option",{value:"Strong",children:"Strong"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Average",children:"Average"}),e.jsx("option",{value:"Weak",children:"Weak"})]})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"attitude",children:"Attitude"}),e.jsxs(c,{type:"select",id:"attitude",name:"attitude",value:r?d.attitude:n.attitude,onChange:t=>f(t,r?x:h),className:"mb-2",children:[e.jsx("option",{value:"",children:"-- Select Rating --"}),e.jsx("option",{value:"Positive",children:"Positive"}),e.jsx("option",{value:"Neutral",children:"Neutral"}),e.jsx("option",{value:"Negative",children:"Negative"})]})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"overall_goal_status",children:"Overall Goal Status"}),e.jsxs(c,{type:"select",id:"overall_goal_status",name:"overall_goal_status",value:r?d.overall_goal_status:n.overall_goal_status,onChange:t=>f(t,r?x:h),className:"mb-2",children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"On Track",children:"On Track"}),e.jsx("option",{value:"Achieved",children:"Achieved"}),e.jsx("option",{value:"Partially Achieved",children:"Partially Achieved"}),e.jsx("option",{value:"Not Achieved",children:"Not Achieved"})]})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"points_earned",children:"Points Earned"}),e.jsx(c,{type:"number",id:"points_earned",name:"points_earned",placeholder:"Points Earned",value:r?d.points_earned:n.points_earned,onChange:t=>f(t,r?x:h),className:"mb-2"})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"total_score",children:"Total Score"}),e.jsx(c,{type:"number",id:"total_score",name:"total_score",placeholder:"Total Score",value:r?d.total_score:n.total_score,onChange:t=>f(t,r?x:h),className:"mb-2"})]})}),e.jsx(u,{md:6,children:e.jsxs(m,{children:[e.jsx(p,{for:"finalGrade",children:"Final Grade"}),e.jsxs(c,{type:"select",id:"finalGrade",name:"finalGrade",value:r?d.finalGrade:n.finalGrade,onChange:t=>f(t,r?x:h),className:"mb-2",children:[e.jsx("option",{value:"",children:"-- Select Grade --"}),e.jsx("option",{value:"A",children:"A"}),e.jsx("option",{value:"B",children:"B"}),e.jsx("option",{value:"C",children:"C"}),e.jsx("option",{value:"D",children:"D"}),e.jsx("option",{value:"F",children:"F"})]})]})}),e.jsx(u,{md:12,children:e.jsxs(m,{children:[e.jsx(p,{for:"recommendation",children:"Recommendation"}),e.jsx(c,{type:"textarea",id:"recommendation",name:"recommendation",placeholder:"Recommendation",value:r?d.recommendation:n.recommendation,onChange:t=>f(t,r?x:h),className:"mb-2"})]})}),e.jsx(u,{md:12,children:e.jsxs(m,{children:[e.jsx(p,{for:"approved",children:"Approved"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(m,{check:!0,className:"me-3",children:e.jsxs(p,{check:!0,children:[e.jsx(c,{type:"radio",name:"approved",value:"Yes",checked:r?d.approved==="Yes":n.approved==="Yes",onChange:t=>f(t,r?x:h)}),"Yes"]})}),e.jsx(m,{check:!0,children:e.jsxs(p,{check:!0,children:[e.jsx(c,{type:"radio",name:"approved",value:"No",checked:r?d.approved==="No":n.approved==="No",onChange:t=>f(t,r?x:h)}),"No"]})})]})]})})]})})}),e.jsxs(ge,{children:[e.jsxs(S,{color:"primary",onClick:r?$:U,children:[r?"Update":"Add"," Feedback"]}),e.jsx(S,{color:"secondary",onClick:ie,children:"Cancel"})]})]})]})};export{Pe as default};
