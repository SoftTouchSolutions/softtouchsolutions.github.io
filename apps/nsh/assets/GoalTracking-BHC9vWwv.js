import{r as a,j as e}from"./mui-CVeSmhdP.js";import{A as N,S as D,aa as L,T as re,a4 as O,l as z,B as g,x as te,y as S,z as w,p as U,q as R,r as q,F as ae,R as G,C as j,v as d,L as h,I as m,s as V,g as J,h as K,f as ne,n as le}from"./index-BH8F5Bwl.js";import{C as oe}from"./CardTitle-DfjUI6oT.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const ce=()=>{const[x,k]=a.useState([]),[l,o]=a.useState(!1),[f,H]=a.useState(null),[c,Q]=a.useState(1),[u,E]=a.useState(null),[I,W]=a.useState([]),[v,_]=a.useState(!1),[y,p]=a.useState(!1),[n,F]=a.useState({progress_percentage:0,status:"",comments:"",milestones_achieved:"",challenges:"",next_steps:""}),C=5;a.useEffect(()=>{X()},[]);const X=async()=>{o(!0);try{const s=await N.getAllGoals();console.log("Fetched goals:",s);const t=Array.isArray(s)?s.map(r=>({id:r.id||r._id||r.goalId,sno:r.sno,employee_name:r.employee_name||r.staff_name||"Unknown",business_goal:r.business_goal||r.goal_description||r.description||"",actual_start_date:r.actual_start_date||r.start_date||"",actual_completion_date:r.actual_completion_date||r.completion_date||"",status:r.status||"Pending",progress_percentage:r.current_progress||r.progress_percentage||0,approved:r.approved})):[];k(t),H(null)}catch(s){console.error("Error fetching goals:",s),H("Failed to load goals. Please try again later."),D.fire({icon:"error",title:"Error",text:"Failed to load goals. Please try again later."})}finally{o(!1)}},A=c*C,Y=A-C,Z=x.slice(Y,A),M=Math.ceil(x.length/C),P=s=>Q(s),T=s=>{switch(s.toLowerCase()){case"approved":return"success";case"rejected":return"danger";case"in progress":return"primary";case"completed":return"info";case"pending":return"warning";default:return"secondary"}},B=s=>s<25?"danger":s<50?"warning":s<75?"info":"success",$=async s=>{try{o(!0);const t=await N.getGoalProgressHistory(s);W(t),_(!0)}catch(t){console.error("Error fetching progress history:",t),D.fire({icon:"error",title:"Error",text:"Failed to fetch progress history."})}finally{o(!1)}},ee=s=>{E(s),F({progress_percentage:s.progress_percentage||0,status:s.status||"",comments:"",milestones_achieved:"",challenges:"",next_steps:""}),p(!0)},i=s=>{const{name:t,value:r}=s.target;F(b=>({...b,[t]:t==="progress_percentage"?parseInt(r):r}))},se=async()=>{if(u)try{o(!0);const s={...n,milestones_achieved:n.milestones_achieved?n.milestones_achieved.split(",").map(r=>r.trim()):[]};await N.createGoalProgress(u.id,s);const t=x.map(r=>r.id===u.id?{...r,progress_percentage:s.progress_percentage,status:s.status}:r);k(t),p(!1),E(null)}catch(s){console.error("Error updating goal progress:",s)}finally{o(!1)}};return e.jsxs("div",{className:"app-container",children:[l&&e.jsx("div",{className:"text-center my-3",children:e.jsx(L,{color:"primary"})}),f&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:f}),!l&&!f&&x.length===0&&e.jsx("div",{className:"alert alert-info",role:"alert",children:"No goals found. Goals will appear here once they are created."}),!l&&x.length>0&&e.jsxs(re,{className:"table table-bordered text-nowrap border-bottom",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Employee Name"}),e.jsx("th",{children:"Business Goal"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"Target Completion"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Z.map(s=>e.jsx(a.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{children:s.employee_name}),e.jsx("td",{children:s.business_goal}),e.jsx("td",{children:s.actual_start_date}),e.jsx("td",{children:s.actual_completion_date}),e.jsx("td",{children:e.jsx(O,{color:T(s.status),children:s.status})}),e.jsx("td",{style:{width:"200px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{style:{flex:1},children:e.jsx(z,{value:s.progress_percentage,color:B(s.progress_percentage),className:"progress-sm"})}),e.jsxs("span",{className:"ms-2",children:[s.progress_percentage,"%"]})]})}),e.jsxs("td",{children:[e.jsx(g,{color:"primary",size:"sm",className:"me-2",onClick:()=>ee(s),disabled:l,children:"Update Progress"}),e.jsx(g,{color:"info",size:"sm",onClick:()=>$(s.id),disabled:l,children:"History"})]})]})},s.id))})]}),e.jsx("nav",{"aria-label":"Page navigation",children:e.jsxs(te,{className:"pagination justify-content-end",children:[e.jsx(S,{disabled:c===1,children:e.jsx(w,{previous:!0,onClick:()=>P(c-1)})}),[...Array(M)].map((s,t)=>e.jsx(S,{active:t+1===c,children:e.jsx(w,{onClick:()=>P(t+1),children:t+1})},t)),e.jsx(S,{disabled:c===M,children:e.jsx(w,{next:!0,onClick:()=>P(c+1)})})]})}),e.jsxs(U,{isOpen:y,toggle:()=>p(!y),size:"lg",children:[e.jsx(R,{toggle:()=>p(!y),children:"Update Goal Progress"}),e.jsx(q,{children:u&&e.jsxs(ae,{children:[e.jsxs(G,{children:[e.jsx(j,{md:6,children:e.jsxs(d,{children:[e.jsx(h,{for:"progress_percentage",children:"Progress Percentage"}),e.jsx(m,{type:"number",name:"progress_percentage",id:"progress_percentage",min:"0",max:"100",value:n.progress_percentage,onChange:i})]})}),e.jsx(j,{md:6,children:e.jsxs(d,{children:[e.jsx(h,{for:"status",children:"Status"}),e.jsxs(m,{type:"select",name:"status",id:"status",value:n.status,onChange:i,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Not Started",children:"Not Started"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"On Hold",children:"On Hold"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]})})]}),e.jsxs(d,{children:[e.jsx(h,{for:"comments",children:"Comments"}),e.jsx(m,{type:"textarea",name:"comments",id:"comments",rows:"3",value:n.comments,onChange:i,placeholder:"Add comments about current progress"})]}),e.jsxs(d,{children:[e.jsx(h,{for:"milestones_achieved",children:"Milestones Achieved"}),e.jsx(m,{type:"textarea",name:"milestones_achieved",id:"milestones_achieved",rows:"2",value:n.milestones_achieved,onChange:i,placeholder:"Enter milestones separated by commas"}),e.jsx("small",{className:"form-text text-muted",children:'Enter milestones separated by commas (e.g., "Research completed, Design phase started")'})]}),e.jsxs(G,{children:[e.jsx(j,{md:6,children:e.jsxs(d,{children:[e.jsx(h,{for:"challenges",children:"Challenges"}),e.jsx(m,{type:"textarea",name:"challenges",id:"challenges",rows:"3",value:n.challenges,onChange:i,placeholder:"Describe any challenges faced"})]})}),e.jsx(j,{md:6,children:e.jsxs(d,{children:[e.jsx(h,{for:"next_steps",children:"Next Steps"}),e.jsx(m,{type:"textarea",name:"next_steps",id:"next_steps",rows:"3",value:n.next_steps,onChange:i,placeholder:"Outline the next steps"})]})})]})]})}),e.jsxs(V,{children:[e.jsx(g,{color:"secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx(g,{color:"primary",onClick:se,disabled:l,children:l?e.jsx(L,{size:"sm"}):"Save Progress"})]})]}),e.jsxs(U,{isOpen:v,toggle:()=>_(!v),size:"lg",children:[e.jsx(R,{toggle:()=>_(!v),children:"Goal Progress History"}),e.jsx(q,{children:I.length===0?e.jsx("div",{className:"alert alert-info",children:"No progress history available for this goal."}):I.map((s,t)=>e.jsx(J,{className:"mb-3",children:e.jsxs(K,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("h5",{className:"mb-0",children:["Progress: ",s.progress_percentage,"% -",e.jsx(O,{color:T(s.status),className:"ms-2",children:s.status})]}),e.jsx("small",{className:"text-muted",children:new Date(s.created_at).toLocaleString()})]}),e.jsx(z,{value:s.progress_percentage,color:B(s.progress_percentage),className:"mb-3"}),s.comments&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Comments:"})," ",s.comments]}),s.milestones_achieved&&s.milestones_achieved.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Milestones:"}),e.jsx("ul",{className:"mb-0 ps-3",children:s.milestones_achieved.map((r,b)=>e.jsx("li",{children:r},b))})]}),s.challenges&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Challenges:"})," ",s.challenges]}),s.next_steps&&e.jsxs("div",{children:[e.jsx("strong",{children:"Next Steps:"})," ",s.next_steps]})]})},s.id||t))}),e.jsx(V,{children:e.jsx(g,{color:"secondary",onClick:()=>_(!1),children:"Close"})})]})]})},pe=()=>e.jsxs("div",{children:[e.jsx(ne,{title:"",home:"Home",name:"Goal Tracking"}),e.jsx(G,{children:e.jsx(j,{md:"12",xl:"12",children:e.jsxs(J,{children:[e.jsx(le,{children:e.jsx(oe,{children:"Goal Progress Tracking"})}),e.jsx(K,{children:e.jsx("div",{className:"table-responsive",children:e.jsx(ce,{})})})]})})})]});export{pe as default};
