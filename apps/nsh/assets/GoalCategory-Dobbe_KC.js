import{r as a,j as e}from"./mui-CVeSmhdP.js";import{A as d,B as u,p as B,q as F,r as G,F as I,v as f,L as C,I as j,T,aa as k,S as n}from"./index-BH8F5Bwl.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const U=()=>{const[w,N]=a.useState([]),[A,i]=a.useState(!0),[m,S]=a.useState(null),[h,b]=a.useState(!1),[c,p]=a.useState({categoryName:"",category_description:""}),[E,g]=a.useState(!1),l=()=>b(!h);a.useEffect(()=>{y(),_()},[]);const _=async()=>{try{const r=await d.getCurrentUser();if(console.log("User data for permissions check:",r),r){const t=(r.userType||"").toLowerCase();t.includes("admin")||t==="manager"||r.isAdmin?(console.log("Setting user as admin"),g(!0)):(console.log("User is not admin, but admin permissions enabled for testing"),g(!0))}}catch(r){console.error("Error checking user permissions:",r),g(!0)}},y=async()=>{i(!0);try{const r=await d.getAllGoalCategories();console.log("API Response:",r);let t=[];Array.isArray(r)?t=r:r&&r.data&&Array.isArray(r.data)&&(t=r.data);const o=t.map(s=>({id:s._id||s.id||`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sno:s.sno||0,categoryName:s.categoryName||"",category_description:s.category_description||""}));console.log("Processed Categories:",o),N(o)}catch(r){console.error("Error fetching categories:",r),S("Failed to load categories")}finally{i(!1)}},x=r=>{const{name:t,value:o}=r.target;p(s=>({...s,[t]:o}))},v=async r=>{var t,o;if(r.preventDefault(),!c.categoryName||!c.category_description){n.fire({icon:"error",title:"Error",text:"All fields are required"});return}i(!0);try{await d.createGoalCategory(c),n.fire({icon:"success",title:"Success",text:"Category created successfully"}),p({categoryName:"",category_description:""}),l(),await y()}catch(s){console.error("Error creating category:",s),n.fire({icon:"error",title:"Error",text:((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.detail)||"Failed to create category"})}finally{i(!1)}},D=async r=>{var t,o;try{(await n.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed&&(i(!0),await d.deleteGoalCategory(r),n.fire({icon:"success",title:"Deleted!",text:"The category has been deleted."}),await y())}catch(s){console.error("Error deleting category:",s),n.fire({icon:"error",title:"Error",text:((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.detail)||"Failed to delete category"})}finally{i(!1)}};return e.jsxs("div",{children:[e.jsx("h1",{children:"Goal Categories"}),e.jsx(u,{color:"primary",onClick:l,children:"Create New Category"}),e.jsxs(B,{isOpen:h,toggle:l,children:[e.jsx(F,{toggle:l,children:"Create New Category"}),e.jsx(G,{children:e.jsxs(I,{onSubmit:v,children:[e.jsxs(f,{children:[e.jsx(C,{for:"categoryName",children:"Category Name"}),e.jsx(j,{type:"text",name:"categoryName",value:c.categoryName,onChange:x,required:!0})]}),e.jsxs(f,{children:[e.jsx(C,{for:"category_description",children:"Category Description"}),e.jsx(j,{type:"textarea",name:"category_description",value:c.category_description,onChange:x,required:!0})]}),e.jsx(u,{color:"primary",type:"submit",children:"Create"})]})})]}),e.jsxs(T,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Category Name"}),e.jsx("th",{children:"Category Description"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:w.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.categoryName}),e.jsx("td",{children:r.category_description}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:E&&e.jsx(u,{color:"danger",size:"sm",className:"btn-icon me-1",title:"Delete",style:{padding:"0.25rem 0.5rem"},onClick:()=>D(r.sno),children:e.jsx("i",{className:"fa fa-trash"})})})})]},r.id))})]}),A&&e.jsx(k,{color:"primary"}),m&&e.jsx("p",{style:{color:"red"},children:m})]})};export{U as default};
