import{r as l,j as e}from"./mui-CVeSmhdP.js";import{a as _,ab as C,al as F,h as H,R as w,C as j,I as c,B as v,p as A,q as B,r as E,L as q,S as i,A as b}from"./index-BH8F5Bwl.js";import{I as p}from"./InputGroup-Bbczs8LD.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const V="/apps/nsh/assets/logo2-C5aQrODH.webp",Y=()=>{const[r,y]=l.useState(""),[d,N]=l.useState(""),[u,x]=l.useState(!1),[n,g]=l.useState(""),[S,m]=l.useState(!1),k=_(),P=C(),{login:M}=F(),h=()=>{x(!u),g(""),m(!1)},I=async s=>{if(s.preventDefault(),!n){i.fire({icon:"warning",title:"Missing Information",text:"Please enter your email address."});return}try{console.log("Sending password reset request for:",n),await b.forgotPassword({email:n})&&(console.log("Password reset request successful"),m(!0),i.fire({icon:"success",title:"Reset Request Sent",text:"Password recovery notification has been sent. Please check your notifications.",timer:3e3,showConfirmButton:!1}),setTimeout(()=>{x(!1),m(!1),g("")},2e3))}catch(t){console.error("Forgot password error:",t),i.fire({icon:"error",title:"Request Failed",text:t.message||"Failed to send password reset request. Please try again."})}},z=async s=>{if(s&&s.preventDefault&&s.preventDefault(),!r||!d){i.fire({icon:"warning",title:"Missing Information",text:"Please enter both email and password."});return}try{console.log("Attempting login with:",{email:r});const t={email:r,password:d};let o;try{if(o=await M(t),console.log("AuthContext login result:",o),o&&o.success){f(r);return}}catch(R){console.error("AuthContext login error:",R)}const a=await b.login(t,P);console.log("API login response:",a),a&&!localStorage.getItem("auth_token")&&localStorage.setItem("auth_token","token_from_api_response");const L=(a==null?void 0:a.user)||r;f(L)}catch(t){console.error("Login error:",t),i.fire({icon:"error",title:"Login Failed",text:t.message||"An unexpected error occurred."})}},f=s=>{try{const t=localStorage.getItem(`user_${s}_has_logged_in`);console.log("Has logged in before:",t);let o;if(!t)console.log("First time login - redirecting to profile"),localStorage.setItem(`user_${s}_has_logged_in`,"true"),o="/employee/profile";else{let a="employee";s.includes("admin")||s.includes("administrator")?a="admin":(s.includes("manager")||s.includes("mgr"))&&(a="manager"),console.log("Return user login with determined type:",a),a==="admin"?o="/dashboard/dashboard01":a==="manager"?o="/dashboard/dashboard02":o="/dashboard/dashboard03"}console.log("Redirecting to:",o);try{k(o,{replace:!0}),console.log("Navigation method 1 executed"),setTimeout(()=>{window.location.pathname.includes("login")&&(console.log("Navigation fallback triggered after timeout"),window.location.href=o)},100)}catch(a){console.error("Navigation error:",a),window.location.href=o}}catch(t){console.error("Redirect error:",t),window.location.href="/"}};return e.jsxs("div",{children:[e.jsx("div",{className:"page",children:e.jsxs("div",{className:"d-md-flex",children:[e.jsx("div",{className:"w-40",children:e.jsx("div",{style:{width:"49%",height:"100%",minHeight:"100vh",backgroundImage:`url(${V})`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center",position:"fixed",left:0,top:0,zIndex:1}})}),e.jsx("div",{className:"w-60 page-content",children:e.jsx("div",{className:"page-single-content",children:e.jsx(H,{className:"p-6",children:e.jsx(w,{children:e.jsxs(j,{md:8,className:"mx-auto d-block",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-2",children:"Login"}),e.jsx("p",{className:"text-muted",children:"Sign In to your account"})]}),e.jsx("hr",{className:"divider my-6"}),e.jsxs(p,{className:"input-group mb-3",children:[e.jsx("span",{className:"input-group-addon",children:e.jsxs("svg",{className:"svg-icon",xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[e.jsx("circle",{cx:"12",cy:"8",opacity:".3",r:"2"}),e.jsx("path",{d:"M12 14c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4zM12 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})]})}),e.jsx(c,{type:"text",className:"form-control",placeholder:"Email",value:r,onChange:s=>y(s.target.value)})]}),e.jsxs(p,{className:"input-group mb-4",children:[e.jsx("span",{className:"input-group-addon",children:e.jsxs("svg",{className:"svg-icon",xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[e.jsx("path",{d:"M6 20h12V10H6v10zm6-7c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z",opacity:".3"}),e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"})]})}),e.jsx(c,{type:"password",className:"form-control",placeholder:"Password",value:d,onChange:s=>N(s.target.value)})]}),e.jsx("div",{className:"d-grid gap-2 mb-3",children:e.jsxs("button",{type:"button",className:"btn btn-primary login-btn",onClick:z,style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"6px",padding:"14px 24px",fontSize:"15px",fontWeight:"500",letterSpacing:"0.3px",boxShadow:"0 2px 8px rgba(102, 126, 234, 0.25)",transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:s=>{s.target.style.transform="translateY(-1px)",s.target.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.35)"},onMouseLeave:s=>{s.target.style.transform="translateY(0)",s.target.style.boxShadow="0 2px 8px rgba(102, 126, 234, 0.25)"},children:[e.jsx("i",{className:"fe fe-arrow-right me-2"})," Login"]})}),e.jsx("div",{className:"text-start",children:e.jsx(v,{color:"link",className:"btn-link box-shadow-0 px-0 text-decoration-none",onClick:h,style:{fontSize:"14px",color:"#6c757d",padding:"0"},children:"Forgot password?"})})]})})})})})]})}),e.jsxs(A,{isOpen:u,toggle:h,centered:!0,children:[e.jsx(B,{toggle:h,children:"Forgot Password"}),e.jsx(E,{children:S?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"fe fe-check-circle text-success",style:{fontSize:"3rem"}})}),e.jsx("h5",{className:"text-success",children:"Email Sent!"}),e.jsx("p",{className:"text-muted",children:"We've sent a password reset link to your email address."})]}):e.jsxs("form",{onSubmit:I,children:[e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-muted",children:"Enter your email address and we'll send you a link to reset your password."})}),e.jsxs(p,{className:"input-group mb-4",children:[e.jsx("span",{className:"input-group-addon",children:e.jsxs("svg",{className:"svg-icon",xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[e.jsx("path",{d:"M0 0h24v24H0V0z",fill:"none"}),e.jsx("path",{d:"M20 8l-8 5-8-5v10h16zm0-2H4l8 4.99z",opacity:".3"}),e.jsx("path",{d:"M4 20h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2zM20 6l-8 4.99L4 6h16zM4 8l8 5 8-5v10H4V8z"})]})}),e.jsx(c,{type:"email",className:"form-control",placeholder:"Enter your email address",value:n,onChange:s=>g(s.target.value),required:!0})]}),e.jsx("div",{className:"mb-3",children:e.jsxs(q,{className:"custom-control custom-checkbox",children:[e.jsx(c,{type:"checkbox",className:"custom-control-input",required:!0}),e.jsx("span",{className:"custom-control-label",children:"I agree to the terms and policy"})]})}),e.jsx(w,{children:e.jsx(j,{className:"col-12",children:e.jsxs(v,{type:"submit",color:"primary",className:"btn btn-lg btn-primary btn-block",disabled:!n,children:[e.jsx("i",{className:"fe fe-mail"})," Send Reset Link"]})})})]})})]})]})};export{Y as default};
