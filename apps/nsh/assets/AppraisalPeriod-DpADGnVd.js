import{r as _,j as e}from"./mui-CVeSmhdP.js";import{F as R,B as h,aa as P,T as Y,p as $,q as Q,r as U,R as k,L as w,I as n,s as G,A as g,S as x,f as J,C as K,g as W,n as X,h as Z}from"./index-Cjmwo3Rz.js";import{C as ee}from"./CardTitle-_F_6FAAC.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const re=s=>{const[o,j]=_.useState(!1),l=()=>j(!o),[c,p]=_.useState(!1),[se,T]=_.useState(!1),A=[{id:"1",period_name:"H1 2024",period_start:"2024-01-01",period_end:"2024-06-30",review_start_date:"2024-07-01",review_end_date:"2024-07-15",review_status:"Completed"},{id:"2",period_name:"H2 2024",period_start:"2024-07-01",period_end:"2024-12-31",review_start_date:"2025-01-01",review_end_date:"2025-01-15",review_status:"Pending"}],[y,N]=_.useState([]),[d,S]=_.useState({}),[a,E]=_.useState({period_name:"",period_start:"",period_end:"",review_start_date:"",review_end_date:"",review_status:""}),[m,D]=_.useState({period_name:"",period_start:"",period_end:"",review_start_date:"",review_end_date:"",review_status:""}),[b,C]=_.useState(null),I=()=>{const r={};if(a.period_name||(r.period_name="Period name is required"),a.period_start||(r.period_start="Start date is required"),a.period_end||(r.period_end="End date is required"),a.review_start_date||(r.review_start_date="Review start date is required"),a.review_end_date||(r.review_end_date="Review end date is required"),a.review_status||(r.review_status="Review status is required"),a.period_start&&a.period_end){const t=new Date(a.period_start),i=new Date(a.period_end);t>i&&(r.period_end="End date must be after start date")}if(a.review_start_date&&a.review_end_date){const t=new Date(a.review_start_date),i=new Date(a.review_end_date);t>i&&(r.review_end_date="Review end date must be after review start date")}return S(r),Object.keys(r).length===0},v=r=>{r.preventDefault();const t=r.target.getAttribute("name"),i=r.target.value,u={...a};if(u[t]=i,E(u),d[t]){const q={...d};delete q[t],S(q)}},B=r=>{r.preventDefault();const t=r.target.getAttribute("name"),i=r.target.value,u={...m};u[t]=i,D(u)},H=async r=>{if(r.preventDefault(),!I()){x.fire({icon:"error",title:"Validation Error",text:"Please fix the errors in the form"});return}p(!0);try{const t={period_name:a.period_name,period_start:a.period_start,period_end:a.period_end,review_start_date:a.review_start_date,review_end_date:a.review_end_date,review_status:a.review_status||"Pending"},i=await g.createAppraisalPeriod(t);console.log("Create appraisal period response:",i),x.fire({icon:"success",title:"Success",text:"Appraisal period created successfully!"}),await f(),l(),E({period_name:"",period_start:"",period_end:"",review_start_date:"",review_end_date:"",review_status:""})}catch(t){console.error("Error adding appraisal period:",t);let i="Failed to create appraisal period. Please try again.";t.response&&(t.response.data&&t.response.data.detail?i=t.response.data.detail:t.response.status===400?i="Invalid data submitted. Please check all fields and try again.":t.response.status===401&&(i="You are not authorized to create appraisal periods.")),x.fire({icon:"error",title:"Error",text:i})}finally{p(!1)}},M=async r=>{r.preventDefault(),p(!0);try{const t=y.find(u=>u.id===b);if(!t||!t.sno)throw console.error("Cannot find period to edit or missing sno:",b),new Error("Cannot find period to edit");const i={period_name:m.period_name,period_start:m.period_start,period_end:m.period_end,review_start_date:m.review_start_date,review_end_date:m.review_end_date,review_status:m.review_status};await g.updateAppraisalPeriod(t.sno,i),await f(),C(null)}catch(t){console.error("Error updating appraisal period:",t),x.fire({icon:"error",title:"Error",text:"Failed to update appraisal period. Please try again."})}finally{p(!1)}},O=(r,t)=>{r.preventDefault(),C(t.id);const i={...t};D(i)},z=()=>{C(null)},L=r=>{if(!r||!r.sno){console.error("Cannot delete period, missing sno:",r),x.fire({icon:"error",title:"Error",text:"Cannot delete this period. Missing identifier."});return}x.fire({title:"Are you sure?",text:`Do you want to delete the appraisal period "${r.period_name}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"}).then(async t=>{if(t.isConfirmed){p(!0);try{await g.deleteAppraisalPeriod(r.sno),await f()}catch(i){console.error("Error deleting appraisal period:",i),x.fire({icon:"error",title:"Error",text:"Failed to delete appraisal period. Please try again."})}finally{p(!1)}}})},V=()=>{T(!0)},f=async()=>{p(!0);try{const r=await g.getAllAppraisalPeriods();console.log("Fetched appraisal periods:",r),Array.isArray(r)&&r.length>0?N(r):(console.warn("No appraisal periods found, using fallback data"),N(A))}catch(r){console.error("Error fetching appraisal periods:",r),N(A)}finally{p(!1)}};return _.useEffect(()=>{V(),f()},[]),e.jsxs("div",{className:"app-container",children:[e.jsxs(R,{onSubmit:M,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx(h,{color:"primary",onClick:l,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm"})," Adding..."]}):"Add New Appraisal Period"}),c&&e.jsx(P,{color:"primary"})]}),e.jsxs(Y,{className:"table table-bordered text-nowrap border-bottom",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Period Name"}),e.jsx("th",{children:"Period Start"}),e.jsx("th",{children:"Period End"}),e.jsx("th",{children:"Review Start Date"}),e.jsx("th",{children:"Review End Date"}),e.jsx("th",{children:"Review Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center",children:c?e.jsx(P,{color:"primary"}):"No appraisal periods found"})}):y.map(r=>e.jsx(_.Fragment,{children:b===r.id?e.jsx(te,{editFormData:m,handleEditFormChange:B,handleCancelClick:z}):e.jsx(ae,{period:r,handleEditClick:O,handleDeleteClick:L})},r.id||r._id||r.sno))})]})]}),e.jsxs($,{isOpen:o,toggle:l,...s,size:"lg",centered:!0,children:[e.jsx(Q,{toggle:l,children:e.jsx("span",{className:"fw-bold",children:"Add New Appraisal Period"})}),e.jsx(U,{children:e.jsxs(R,{onSubmit:H,children:[e.jsxs(k,{children:[e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx(w,{for:"period_name",children:"Period Name"}),e.jsx(n,{type:"text",id:"period_name",name:"period_name",placeholder:"Enter Period Name (e.g., H1 2025, Q3 2025)",value:a.period_name,onChange:v,required:!0,className:"form-control"}),d.period_name&&e.jsx("span",{className:"text-danger small",children:d.period_name})]}),e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx(w,{for:"period_start",children:"Period Start"}),e.jsx(n,{type:"date",id:"period_start",name:"period_start",value:a.period_start,onChange:v,required:!0,className:"form-control"}),d.period_start&&e.jsx("span",{className:"text-danger small",children:d.period_start})]}),e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx(w,{for:"period_end",children:"Period End"}),e.jsx(n,{type:"date",id:"period_end",name:"period_end",value:a.period_end,onChange:v,required:!0,className:"form-control"}),d.period_end&&e.jsx("span",{className:"text-danger small",children:d.period_end})]}),e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx(w,{for:"review_start_date",children:"Review Start Date"}),e.jsx(n,{type:"date",id:"review_start_date",name:"review_start_date",value:a.review_start_date,onChange:v,required:!0,className:"form-control"}),d.review_start_date&&e.jsx("span",{className:"text-danger small",children:d.review_start_date})]}),e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx(w,{for:"review_end_date",children:"Review End Date"}),e.jsx(n,{type:"date",id:"review_end_date",name:"review_end_date",value:a.review_end_date,onChange:v,required:!0,className:"form-control"}),d.review_end_date&&e.jsx("span",{className:"text-danger small",children:d.review_end_date})]}),e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx(w,{for:"review_status",children:"Review Status (Optional)"}),e.jsxs(n,{type:"select",id:"review_status",name:"review_status",value:a.review_status,onChange:v,className:"form-control",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Completed",children:"Completed"})]}),d.review_status&&e.jsx("span",{className:"text-danger small",children:d.review_status})]})]}),e.jsx(h,{color:"primary",className:"mt-2 px-4",type:"submit",children:"Add Appraisal Period"})]})}),e.jsx(G,{children:e.jsx(h,{color:"secondary",onClick:l,children:"Close"})})]})]})},te=({editFormData:s,handleEditFormChange:o,handleCancelClick:j})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(n,{type:"text",required:!0,name:"period_name",value:s.period_name,onChange:o,className:"form-control"})}),e.jsx("td",{children:e.jsx(n,{type:"date",required:!0,name:"period_start",value:s.period_start,onChange:o,className:"form-control"})}),e.jsx("td",{children:e.jsx(n,{type:"date",required:!0,name:"period_end",value:s.period_end,onChange:o,className:"form-control"})}),e.jsx("td",{children:e.jsx(n,{type:"date",required:!0,name:"review_start_date",value:s.review_start_date,onChange:o,className:"form-control"})}),e.jsx("td",{children:e.jsx(n,{type:"date",required:!0,name:"review_end_date",value:s.review_end_date,onChange:o,className:"form-control"})}),e.jsx("td",{children:e.jsxs(n,{type:"select",name:"review_status",value:s.review_status,onChange:o,className:"form-control",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Completed",children:"Completed"})]})}),e.jsxs("td",{children:[e.jsx(h,{color:"primary",className:"me-1",type:"submit",children:"Save"}),e.jsx(h,{color:"danger",className:"me-1",type:"button",onClick:j,children:"Cancel"})]})]}),ae=({period:s,handleEditClick:o,handleDeleteClick:j})=>{const l=c=>{if(!c)return"N/A";try{return new Date(c).toLocaleDateString()}catch{return c}};return e.jsxs("tr",{children:[e.jsx("td",{children:s.period_name}),e.jsx("td",{children:l(s.period_start)}),e.jsx("td",{children:l(s.period_end)}),e.jsx("td",{children:l(s.review_start_date)}),e.jsx("td",{children:l(s.review_end_date)}),e.jsx("td",{children:e.jsx("span",{className:`badge bg-${s.review_status==="Completed"?"success":s.review_status==="In Progress"?"warning":s.review_status==="Planned"?"info":"danger"}`,children:s.review_status})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx(h,{color:"primary",size:"sm",className:"btn-icon me-1",title:"Edit",style:{padding:"0.25rem 0.5rem"},onClick:c=>o(c,s),children:e.jsx("i",{className:"fa fa-edit"})}),e.jsx(h,{color:"danger",size:"sm",className:"btn-icon me-1",title:"Delete",style:{padding:"0.25rem 0.5rem"},onClick:()=>j(s),children:e.jsx("i",{className:"fa fa-trash"})})]})})]})},F=()=>e.jsxs("div",{children:[e.jsx(J,{title:"",home:"Home",name:"Appraisal Period"}),e.jsx(k,{children:e.jsx(K,{md:"12",xl:"12",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsx(ee,{children:"Appraisal Period"})}),e.jsx(Z,{children:e.jsx("div",{className:"table-responsive",children:e.jsx(re,{})})})]})})})]});F.propTypes={};F.defaultProps={};export{F as default};
