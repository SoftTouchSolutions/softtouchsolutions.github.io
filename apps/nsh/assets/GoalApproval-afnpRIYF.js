import{r as o,j as e}from"./mui-CVeSmhdP.js";import{A as u,S as k,aa as E,T as R,a4 as x,B as _,x as B,y as m,z as f,f as D,R as T,C as F,g as I,n as L,h as H}from"./index-Cjmwo3Rz.js";import{C as O}from"./CardTitle-_F_6FAAC.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const z=()=>{const[n,d]=o.useState([]),[i,l]=o.useState(!1),[p,v]=o.useState(null);o.useEffect(()=>{b()},[]);const b=async()=>{l(!0);try{const a=await u.getAllGoals();console.log("Fetched goals:",a);const t=Array.isArray(a)?a.map(s=>({id:s.id||s._id||s.goalId,sno:s.sno,employee_name:s.employee_name||s.staff_name||"Unknown",business_goal:s.business_goal||s.goal_description||s.description||"",actual_start_date:s.actual_start_date||s.start_date||"",actual_completion_date:s.actual_completion_date||s.completion_date||"",status:s.status||"Pending",approved:s.approved})):[];d(t),v(null)}catch(a){console.error("Error fetching goals:",a),v("Failed to load goals. Please try again later."),k.fire({icon:"error",title:"Error",text:"Failed to load goals. Please try again later."})}finally{l(!1)}},[c,A]=o.useState(1),h=5,y=c*h,P=y-h,G=n.slice(P,y),g=Math.ceil(n.length/h),j=a=>A(a),N=a=>{switch(a.toLowerCase()){case"approved":return"success";case"rejected":return"danger";case"in progress":return"primary";case"completed":return"info";case"pending":return"warning";default:return"secondary"}},S=async(a,t)=>{try{l(!0),await u.approveGoal(t);const s=n.map(r=>r.id===a?{...r,status:"Approved",approved:!0}:r);d(s)}catch(s){console.error("Error approving goal:",s)}finally{l(!1)}},w=async(a,t)=>{try{l(!0),await u.rejectGoal(t);const s=n.map(r=>r.id===a?{...r,status:"Rejected",approved:!1}:r);d(s)}catch(s){console.error("Error rejecting goal:",s)}finally{l(!1)}};return e.jsxs("div",{className:"app-container",children:[i&&e.jsx("div",{className:"text-center my-3",children:e.jsx(E,{color:"primary"})}),p&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:p}),!i&&!p&&n.length===0&&e.jsx("div",{className:"alert alert-info",role:"alert",children:"No goals found. Goals will appear here once they are created."}),!i&&n.length>0&&e.jsxs(R,{className:"table table-bordered text-nowrap border-bottom",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Employee Name"}),e.jsx("th",{children:"Business Goal"}),e.jsx("th",{children:"Actual Start Date"}),e.jsx("th",{children:"Actual Completion Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Approval Status"})]})}),e.jsx("tbody",{children:G.map(a=>e.jsx(o.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{children:a.employee_name}),e.jsx("td",{children:a.business_goal}),e.jsx("td",{children:a.actual_start_date}),e.jsx("td",{children:a.actual_completion_date}),e.jsx("td",{children:e.jsx(x,{color:N(a.status),children:a.status})}),e.jsx("td",{children:a.status==="Approved"?e.jsx(x,{color:"success",children:"Approved"}):a.status==="Rejected"?e.jsx(x,{color:"danger",children:"Rejected"}):e.jsxs("div",{children:[e.jsx(_,{color:"success",className:"me-2",onClick:()=>S(a.id,a.sno),disabled:i,children:"Approve"}),e.jsx(_,{color:"danger",onClick:()=>w(a.id,a.sno),disabled:i,children:"Reject"})]})})]})},a.id))})]}),e.jsx("nav",{"aria-label":"Page navigation",children:e.jsxs(B,{className:"pagination justify-content-end",children:[e.jsx(m,{disabled:c===1,children:e.jsx(f,{href:"#",onClick:a=>{a.preventDefault(),j(c-1)},children:e.jsx("i",{className:"fa fa-angle-left"})})}),[...Array(g)].map((a,t)=>e.jsx(m,{active:c===t+1,children:e.jsx(f,{href:"#",onClick:s=>{s.preventDefault(),j(t+1)},children:t+1})},t)),e.jsx(m,{disabled:c===g,children:e.jsx(f,{href:"#",onClick:a=>{a.preventDefault(),j(c+1)},children:e.jsx("i",{className:"fa fa-angle-right"})})})]})})]})},C=()=>e.jsxs("div",{children:[e.jsx(D,{title:"",home:"Home",name:"Goals Approval"}),e.jsx(T,{children:e.jsx(F,{md:"12",xl:"12",children:e.jsxs(I,{children:[e.jsx(L,{children:e.jsx(O,{children:"Goals Approval"})}),e.jsx(H,{children:e.jsx("div",{className:"table-responsive",children:e.jsx(z,{})})})]})})})]});C.propTypes={};C.defaultProps={};export{C as default};
