import{r as u,j as e}from"./mui-CVeSmhdP.js";import{a as R,A as g,S as x,f as $,R as w,C as l,g as O,n as T,h as B,F as Y,v as s,L as o,I as i,B as D,aa as H}from"./index-Cjmwo3Rz.js";import{C as M}from"./CardTitle-_F_6FAAC.js";import"./vendor-CC_ZIGTP.js";import"./utils-ngrFHoWO.js";const U=()=>{const F=R(),[k,c]=u.useState(!1),[r,y]=u.useState({}),[L,P]=u.useState(!1),[Q,v]=u.useState([]),[b,j]=u.useState([]),[a,N]=u.useState({employeeID:"",staff_name:"",deptcode:"",deptname:"",reviewPeriod:"",feedback_date:new Date().toISOString().split("T")[0],task_execution:"",power_skills:"",attitude:"",overall_goal_status:"",points_earned:"",total_score:"",finalGrade:"",recommendation:"",approved:"No"});u.useEffect(()=>{C(),E()},[]);const C=async()=>{c(!0);try{const t=await g.getAllDepartments();t&&t.length>0?v(t):(v([]),console.log("No departments found in the database"))}catch(t){console.error("Error fetching departments:",t),v([]),x.fire({icon:"error",title:"Error",text:"Failed to fetch departments from the server. Please try again later."})}finally{c(!1)}},E=async()=>{c(!0);try{const t=await g.getAllEmployees();t&&t.length>0?j(t):(j([]),console.log("No employees found in the database"))}catch(t){console.error("Error fetching employees:",t),j([]),x.fire({icon:"error",title:"Error",text:"Failed to fetch employees from the server. Please try again later."})}finally{c(!1)}},n=t=>{const{name:m,value:p,type:f}=t.target;if(N(d=>({...d,[m]:p})),m==="employeeID"&&p){const d=b.find(h=>h.employeeID===p);d&&N(h=>({...h,staff_name:d.staff_name||"",deptcode:d.deptcode||"",deptname:d.deptname||""}))}r[m]&&y({...r,[m]:void 0})},A=()=>{const t={};return a.employeeID||(t.employeeID="Employee is required"),a.reviewPeriod||(t.reviewPeriod="Review period is required"),a.feedback_date||(t.feedback_date="Feedback date is required"),a.task_execution||(t.task_execution="Task execution rating is required"),a.attitude||(t.attitude="Attitude rating is required"),a.overall_goal_status||(t.overall_goal_status="Overall goal status is required"),y(t),Object.keys(t).length===0},I=async t=>{var m,p;if(t.preventDefault(),!A()){x.fire({icon:"error",title:"Validation Error",text:"Please fill in all required fields."});return}c(!0);try{const d=["employeeID","reviewPeriod"].filter(_=>!a[_]);if(d.length>0){x.fire("Error",`Please fill in the following required fields: ${d.join(", ")}`,"error"),c(!1);return}let h=a.reviewPeriod;if(!h.match(/^\d{4}-(?:Q[1-4]|H[1-2]|Annual)$/)){const _=new Date().getFullYear(),q=Math.ceil((new Date().getMonth()+1)/3);h=`${_}-Q${q}`}const S={employeeID:a.employeeID,staff_name:a.staff_name||"",deptcode:a.deptcode||"",deptname:a.deptname||"",reviewPeriod:h,task_execution:a.task_execution,power_skills:a.power_skills,attitude:a.attitude,overall_goal_status:a.overall_goal_status,points_earned:parseInt(a.points_earned||0,10),total_score:Math.min(Math.max(parseFloat(a.total_score||0),0),100),approved:a.approved==="Yes"?1:0,recommendation:a.recommendation||""};console.log("Formatted feedback data:",S);const G=await g.createFeedback(S);console.log("Feedback created:",G),P(!0),x.fire({icon:"success",title:"Success",text:"Feedback submitted successfully!",showConfirmButton:!0})}catch(f){console.error("Error submitting feedback:",f),x.fire({icon:"error",title:"Error",text:((p=(m=f.response)==null?void 0:m.data)==null?void 0:p.detail)||"Failed to submit feedback. Please try again."})}finally{c(!1)}};return e.jsxs("div",{children:[e.jsx($,{title:"",home:"Home",name:"Feedback",fonticonsname:"Create Feedback"}),e.jsx(w,{children:e.jsx(l,{md:"12",xl:"12",children:e.jsxs(O,{children:[e.jsx(T,{children:e.jsx(M,{tag:"h3",children:"Employee Feedback Form"})}),e.jsx(B,{children:e.jsxs(Y,{onSubmit:I,children:[e.jsxs(w,{children:[e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"employeeSelect",children:"Select Employee *"}),e.jsxs(i,{type:"select",name:"employeeID",id:"employeeSelect",value:a.employeeID,onChange:n,className:`form-control ${r.employeeID?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Select Employee --"}),b.map(t=>e.jsxs("option",{value:t.employeeID,children:[t.staff_name," - ",t.job_role||"N/A"]},t.employeeID))]}),r.employeeID&&e.jsx("div",{className:"invalid-feedback",children:r.employeeID})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"staff_name",children:"Staff Name"}),e.jsx(i,{type:"text",id:"staff_name",name:"staff_name",value:a.staff_name,readOnly:!0,className:"form-control"})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"deptname",children:"Department"}),e.jsx(i,{type:"text",id:"deptname",name:"deptname",value:a.deptname,readOnly:!0,className:"form-control"})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"reviewPeriod",children:"Review Period *"}),e.jsx(i,{type:"text",id:"reviewPeriod",name:"reviewPeriod",value:a.reviewPeriod,onChange:n,placeholder:"e.g. Q1 2024",className:`form-control ${r.reviewPeriod?"is-invalid":""}`}),r.reviewPeriod&&e.jsx("div",{className:"invalid-feedback",children:r.reviewPeriod})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"feedback_date",children:"Feedback Date *"}),e.jsx(i,{type:"date",id:"feedback_date",name:"feedback_date",value:a.feedback_date,onChange:n,className:`form-control ${r.feedback_date?"is-invalid":""}`}),r.feedback_date&&e.jsx("div",{className:"invalid-feedback",children:r.feedback_date})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"task_execution",children:"Task Execution *"}),e.jsxs(i,{type:"select",id:"task_execution",name:"task_execution",value:a.task_execution,onChange:n,className:`form-control ${r.task_execution?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Select Rating --"}),e.jsx("option",{value:"Excellent",children:"Excellent"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Average",children:"Average"}),e.jsx("option",{value:"Poor",children:"Poor"})]}),r.task_execution&&e.jsx("div",{className:"invalid-feedback",children:r.task_execution})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"power_skills",children:"Power Skills"}),e.jsxs(i,{type:"select",id:"power_skills",name:"power_skills",value:a.power_skills,onChange:n,className:"form-control",children:[e.jsx("option",{value:"",children:"-- Select Rating --"}),e.jsx("option",{value:"Strong",children:"Strong"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Average",children:"Average"}),e.jsx("option",{value:"Weak",children:"Weak"})]})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"attitude",children:"Attitude *"}),e.jsxs(i,{type:"select",id:"attitude",name:"attitude",value:a.attitude,onChange:n,className:`form-control ${r.attitude?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Select Rating --"}),e.jsx("option",{value:"Positive",children:"Positive"}),e.jsx("option",{value:"Neutral",children:"Neutral"}),e.jsx("option",{value:"Negative",children:"Negative"})]}),r.attitude&&e.jsx("div",{className:"invalid-feedback",children:r.attitude})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"overall_goal_status",children:"Overall Goal Status *"}),e.jsxs(i,{type:"select",id:"overall_goal_status",name:"overall_goal_status",value:a.overall_goal_status,onChange:n,className:`form-control ${r.overall_goal_status?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"On Track",children:"On Track"}),e.jsx("option",{value:"Achieved",children:"Achieved"}),e.jsx("option",{value:"Partially Achieved",children:"Partially Achieved"}),e.jsx("option",{value:"Not Achieved",children:"Not Achieved"})]}),r.overall_goal_status&&e.jsx("div",{className:"invalid-feedback",children:r.overall_goal_status})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"points_earned",children:"Points Earned"}),e.jsx(i,{type:"number",id:"points_earned",name:"points_earned",value:a.points_earned,onChange:n,placeholder:"Points Earned",className:"form-control"})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"total_score",children:"Total Score"}),e.jsx(i,{type:"number",id:"total_score",name:"total_score",value:a.total_score,onChange:n,placeholder:"Total Score",className:"form-control"})]})}),e.jsx(l,{md:6,children:e.jsxs(s,{children:[e.jsx(o,{for:"finalGrade",children:"Final Grade"}),e.jsxs(i,{type:"select",id:"finalGrade",name:"finalGrade",value:a.finalGrade,onChange:n,className:"form-control",children:[e.jsx("option",{value:"",children:"-- Select Grade --"}),e.jsx("option",{value:"A",children:"A"}),e.jsx("option",{value:"B",children:"B"}),e.jsx("option",{value:"C",children:"C"}),e.jsx("option",{value:"D",children:"D"}),e.jsx("option",{value:"F",children:"F"})]})]})}),e.jsx(l,{md:12,children:e.jsxs(s,{children:[e.jsx(o,{for:"recommendation",children:"Recommendation"}),e.jsx(i,{type:"textarea",id:"recommendation",name:"recommendation",value:a.recommendation,onChange:n,placeholder:"Recommendation",className:"form-control",rows:"4"})]})}),e.jsx(l,{md:12,children:e.jsxs(s,{children:[e.jsx(o,{for:"approved",children:"Approved"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(s,{check:!0,className:"me-3",children:e.jsxs(o,{check:!0,children:[e.jsx(i,{type:"radio",name:"approved",value:"Yes",checked:a.approved==="Yes",onChange:n,className:"form-check-input"}),"Yes"]})}),e.jsx(s,{check:!0,children:e.jsxs(o,{check:!0,children:[e.jsx(i,{type:"radio",name:"approved",value:"No",checked:a.approved==="No",onChange:n,className:"form-check-input"}),"No"]})})]})]})})]}),e.jsxs("div",{className:"form-footer mt-4",children:[e.jsxs(D,{color:"primary",type:"submit",disabled:k,children:[k?e.jsx(H,{size:"sm"}):null," Submit Feedback"]}),e.jsx(D,{color:"secondary",className:"ms-2",onClick:()=>F("/feed/back/details"),children:"Cancel"})]})]})})]})})})]})};export{U as default};
